This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
__tests__/home.test.tsx
.agent/workflows/install_package.md
.agent/workflows/run_scripts.md
.gitignore
app/contracts/page.tsx
app/dashboard/page.tsx
app/employees/new/page.tsx
app/employees/page.tsx
app/favicon.ico
app/globals.css
app/layout.tsx
app/leave/page.tsx
app/page.tsx
app/preview/page.tsx
app/settings/page.tsx
app/ufiling/page.tsx
app/wizard/page.tsx
components/layout/side-drawer.tsx
components/theme-provider.tsx
components/ui/alert.tsx
components/ui/button.tsx
components/ui/card.tsx
components/ui/input.tsx
components/ui/label.tsx
components/ui/stepper.tsx
e2e/home.spec.ts
eslint.config.mjs
lib/calculator.ts
lib/contract-pdf.ts
lib/leave.ts
lib/pdf.ts
lib/schema.ts
lib/schemas/payslip.ts
lib/share.ts
lib/storage.ts
lib/ufiling.ts
next.config.ts
package.json
playwright.config.ts
postcss.config.mjs
public/file.svg
public/globe.svg
public/next.svg
public/vercel.svg
public/window.svg
README.md
tsconfig.json
vitest.config.ts
vitest.setup.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".agent/workflows/install_package.md">
---
description: Install NPM Packages Automatically
---

// turbo-all

1. Run the NPM install command to add the requested package.
</file>

<file path=".agent/workflows/run_scripts.md">
---
description: Execute build or utility scripts without asking for permission
---

// turbo-all

1. Run the required npm or bash script to compile / fix / build the application.
</file>

<file path="app/contracts/page.tsx">
"use client";

import * as React from "react";
import Link from "next/link";
import {
    ArrowLeft, Loader2, FileText, Download, Users,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { SideDrawer } from "@/components/layout/side-drawer";
import { getEmployees, getSettings } from "@/lib/storage";
import { Employee, EmployerSettings } from "@/lib/schema";
import { generateContractPdfBytes, ContractInput } from "@/lib/contract-pdf";

export default function ContractsPage() {
    const [loading, setLoading] = React.useState(true);
    const [generating, setGenerating] = React.useState(false);
    const [employees, setEmployees] = React.useState<Employee[]>([]);
    const [settings, setSettings] = React.useState<EmployerSettings | null>(null);
    const [selectedId, setSelectedId] = React.useState("");
    const [form, setForm] = React.useState({
        startDate: new Date().toISOString().slice(0, 10),
        workDays: "Monday to Friday",
        workHoursPerDay: "8",
        duties: "General domestic duties including cleaning, laundry, ironing, and cooking as reasonably assigned by the employer.",
        probationMonths: "3",
    });

    React.useEffect(() => {
        async function load() {
            const [emps, s] = await Promise.all([getEmployees(), getSettings()]);
            setEmployees(emps);
            setSettings(s);
            if (emps.length > 0) setSelectedId(emps[0].id);
            setLoading(false);
        }
        load();
    }, []);

    const selectedEmployee = employees.find((e) => e.id === selectedId);

    const handleGenerate = async () => {
        if (!selectedEmployee || !settings) return;
        setGenerating(true);
        try {
            const input: ContractInput = {
                employee: selectedEmployee,
                employer: settings,
                startDate: form.startDate,
                workDays: form.workDays,
                workHoursPerDay: parseInt(form.workHoursPerDay) || 8,
                duties: form.duties,
                probationMonths: parseInt(form.probationMonths) || 0,
            };
            const pdfBytes = await generateContractPdfBytes(input);
            const blob = new Blob([pdfBytes.slice(0)], { type: "application/pdf" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `Contract_${selectedEmployee.name.replace(/\s+/g, "_")}.pdf`;
            a.click();
            URL.revokeObjectURL(url);
        } catch (err) {
            console.error("Contract generation failed:", err);
        }
        setGenerating(false);
    };

    return (
        <div className="min-h-screen flex flex-col" style={{ backgroundColor: "var(--bg-base)" }}>
            <header
                className="sticky top-0 z-30 px-4 py-3"
                style={{
                    backgroundColor: "var(--bg-surface)",
                    borderBottom: "1px solid var(--border-subtle)",
                    boxShadow: "var(--shadow-sm)",
                }}
            >
                <div className="max-w-xl mx-auto flex items-center gap-3">
                    <SideDrawer />
                    <Link href="/dashboard">
                        <button
                            aria-label="Back"
                            className="h-9 w-9 flex items-center justify-center rounded-xl transition-colors hover:bg-[var(--bg-subtle)]"
                            style={{ color: "var(--text-secondary)" }}
                        >
                            <ArrowLeft className="h-4 w-4" />
                        </button>
                    </Link>
                    <h1 className="font-bold text-base tracking-tight" style={{ color: "var(--text-primary)" }}>
                        Employment Contracts
                    </h1>
                </div>
            </header>

            <main className="flex-1 max-w-xl mx-auto w-full px-4 py-6 space-y-5">
                {loading ? (
                    <div className="flex items-center justify-center py-20">
                        <Loader2 className="h-6 w-6 animate-spin" style={{ color: "var(--amber-500)" }} />
                    </div>
                ) : employees.length === 0 ? (
                    <Card>
                        <CardContent className="p-8 text-center">
                            <Users className="h-10 w-10 mx-auto mb-3" style={{ color: "var(--text-muted)" }} />
                            <p className="font-semibold mb-1" style={{ color: "var(--text-primary)" }}>No employees yet</p>
                            <p className="text-sm mb-4" style={{ color: "var(--text-muted)" }}>
                                Add at least one employee to generate a contract.
                            </p>
                            <Link href="/employees/new">
                                <Button className="gap-2">Add Employee</Button>
                            </Link>
                        </CardContent>
                    </Card>
                ) : (
                    <>
                        {/* Info */}
                        <Card className="animate-slide-up">
                            <CardContent className="p-4 flex items-start gap-3">
                                <FileText className="h-5 w-5 mt-0.5 shrink-0" style={{ color: "var(--amber-500)" }} />
                                <div>
                                    <p className="text-sm font-semibold" style={{ color: "var(--text-primary)" }}>
                                        BCEA Employment Contract
                                    </p>
                                    <p className="text-xs mt-1" style={{ color: "var(--text-muted)" }}>
                                        Generate a legally compliant employment contract with leave entitlements,
                                        termination clauses, and signature lines. Protects both you and your worker.
                                    </p>
                                </div>
                            </CardContent>
                        </Card>

                        {/* Employee selector */}
                        <Card className="animate-slide-up">
                            <CardContent className="p-5 space-y-4">
                                <div className="space-y-2">
                                    <Label htmlFor="contract-employee">Select Employee</Label>
                                    <select
                                        id="contract-employee"
                                        value={selectedId}
                                        onChange={(e) => setSelectedId(e.target.value)}
                                        className="w-full rounded-lg px-3 py-2.5 text-sm font-medium"
                                        style={{
                                            backgroundColor: "var(--bg-subtle)",
                                            color: "var(--text-primary)",
                                            border: "1px solid var(--border-subtle)",
                                        }}
                                    >
                                        {employees.map((e) => (
                                            <option key={e.id} value={e.id}>{e.name} — {e.role}</option>
                                        ))}
                                    </select>
                                </div>

                                <div className="grid grid-cols-2 gap-3">
                                    <div className="space-y-2">
                                        <Label htmlFor="contract-start">Start Date</Label>
                                        <Input
                                            id="contract-start"
                                            type="date"
                                            value={form.startDate}
                                            onChange={(e) => setForm({ ...form, startDate: e.target.value })}
                                        />
                                    </div>
                                    <div className="space-y-2">
                                        <Label htmlFor="contract-probation">Probation (months)</Label>
                                        <Input
                                            id="contract-probation"
                                            type="number"
                                            min="0"
                                            max="12"
                                            value={form.probationMonths}
                                            onChange={(e) => setForm({ ...form, probationMonths: e.target.value })}
                                        />
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-3">
                                    <div className="space-y-2">
                                        <Label htmlFor="contract-days">Work Days</Label>
                                        <Input
                                            id="contract-days"
                                            placeholder="Monday to Friday"
                                            value={form.workDays}
                                            onChange={(e) => setForm({ ...form, workDays: e.target.value })}
                                        />
                                    </div>
                                    <div className="space-y-2">
                                        <Label htmlFor="contract-hours">Hours/Day</Label>
                                        <Input
                                            id="contract-hours"
                                            type="number"
                                            min="1"
                                            max="12"
                                            value={form.workHoursPerDay}
                                            onChange={(e) => setForm({ ...form, workHoursPerDay: e.target.value })}
                                        />
                                    </div>
                                </div>

                                <div className="space-y-2">
                                    <Label htmlFor="contract-duties">Job Duties</Label>
                                    <textarea
                                        id="contract-duties"
                                        rows={3}
                                        value={form.duties}
                                        onChange={(e) => setForm({ ...form, duties: e.target.value })}
                                        className="w-full rounded-lg px-4 py-3 text-sm resize-none"
                                        style={{
                                            backgroundColor: "var(--bg-subtle)",
                                            color: "var(--text-primary)",
                                            border: "1px solid var(--border-subtle)",
                                        }}
                                    />
                                </div>

                                {settings && !settings.employerName && (
                                    <p className="text-xs" style={{ color: "var(--amber-500)" }}>
                                        ⚠ Employer details not set.{" "}
                                        <Link href="/settings" className="underline">Add them in Settings</Link> for a complete contract.
                                    </p>
                                )}
                            </CardContent>
                        </Card>

                        {/* Generate button */}
                        <Button
                            className="w-full gap-2 h-12 text-base"
                            onClick={handleGenerate}
                            disabled={generating || !selectedEmployee}
                        >
                            {generating ? (
                                <><Loader2 className="h-5 w-5 animate-spin" /> Generating…</>
                            ) : (
                                <><Download className="h-5 w-5" /> Download Contract PDF</>
                            )}
                        </Button>
                    </>
                )}
            </main>
        </div>
    );
}
</file>

<file path="app/dashboard/page.tsx">
"use client";

import * as React from "react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import {
    Users, ChevronRight, RefreshCw, Loader2,
    CalendarDays, DollarSign, Clock, ArrowRight,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { SideDrawer } from "@/components/layout/side-drawer";
import { getEmployees, getLatestPayslip } from "@/lib/storage";
import { Employee, PayslipInput } from "@/lib/schema";
import { calculatePayslip } from "@/lib/calculator";
import { format } from "date-fns";

interface EmployeeSummary {
    employee: Employee;
    lastPayslip: PayslipInput | null;
    netPay: number | null;
}

export default function DashboardPage() {
    const router = useRouter();
    const [loading, setLoading] = React.useState(true);
    const [summaries, setSummaries] = React.useState<EmployeeSummary[]>([]);

    React.useEffect(() => {
        async function load() {
            const employees = await getEmployees();
            const results: EmployeeSummary[] = [];
            for (const emp of employees) {
                const lastPayslip = await getLatestPayslip(emp.id);
                let netPay: number | null = null;
                if (lastPayslip) {
                    const breakdown = calculatePayslip(lastPayslip);
                    netPay = breakdown.netPay;
                }
                results.push({ employee: emp, lastPayslip, netPay });
            }
            setSummaries(results);
            setLoading(false);
        }
        load();
    }, []);

    const totalMonthly = summaries.reduce((sum, s) => sum + (s.netPay ?? 0), 0);
    const employeeCount = summaries.length;

    const handleRepeat = (empId: string) => {
        router.push(`/wizard?employeeId=${empId}&repeat=true`);
    };

    return (
        <div className="min-h-screen flex flex-col" style={{ backgroundColor: "var(--bg-base)" }}>
            {/* Header */}
            <header
                className="sticky top-0 z-30 px-4 py-3 flex items-center justify-between"
                style={{
                    backgroundColor: "var(--bg-surface)",
                    borderBottom: "1px solid var(--border-subtle)",
                    boxShadow: "var(--shadow-sm)",
                }}
            >
                <div className="flex items-center gap-3">
                    <SideDrawer />
                    <h1 className="font-bold text-base tracking-tight" style={{ color: "var(--text-primary)" }}>
                        Dashboard
                    </h1>
                </div>
                <Link href="/employees">
                    <Button size="sm" variant="outline" className="gap-1.5">
                        <Users className="h-4 w-4" /> Employees
                    </Button>
                </Link>
            </header>

            <main className="flex-1 max-w-2xl mx-auto w-full px-4 py-6 space-y-6">
                {loading ? (
                    <div className="flex items-center justify-center py-20">
                        <Loader2 className="h-6 w-6 animate-spin" style={{ color: "var(--amber-500)" }} />
                    </div>
                ) : (
                    <>
                        {/* Summary Cards */}
                        <div className="grid grid-cols-2 gap-3 animate-slide-up">
                            <Card>
                                <CardContent className="p-4 flex flex-col items-center text-center">
                                    <div
                                        className="h-10 w-10 rounded-xl flex items-center justify-center mb-2"
                                        style={{ backgroundColor: "rgba(196,122,28,0.12)" }}
                                    >
                                        <Users className="h-5 w-5" style={{ color: "var(--amber-500)" }} />
                                    </div>
                                    <p className="text-2xl font-extrabold" style={{ color: "var(--text-primary)" }}>
                                        {employeeCount}
                                    </p>
                                    <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                                        Employee{employeeCount !== 1 ? "s" : ""}
                                    </p>
                                </CardContent>
                            </Card>
                            <Card>
                                <CardContent className="p-4 flex flex-col items-center text-center">
                                    <div
                                        className="h-10 w-10 rounded-xl flex items-center justify-center mb-2"
                                        style={{ backgroundColor: "rgba(196,122,28,0.12)" }}
                                    >
                                        <DollarSign className="h-5 w-5" style={{ color: "var(--amber-500)" }} />
                                    </div>
                                    <p className="text-2xl font-extrabold" style={{ color: "var(--text-primary)" }}>
                                        R {totalMonthly.toFixed(0)}
                                    </p>
                                    <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                                        Last Payroll Total
                                    </p>
                                </CardContent>
                            </Card>
                        </div>

                        {/* Employee list with repeat */}
                        <div className="space-y-3">
                            <div className="flex items-center justify-between">
                                <h2 className="text-sm font-bold" style={{ color: "var(--text-primary)" }}>
                                    Quick Payroll
                                </h2>
                                <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                                    Repeat last month&apos;s payslip
                                </p>
                            </div>

                            {summaries.length === 0 ? (
                                <Card>
                                    <CardContent className="p-8 text-center">
                                        <Users className="h-10 w-10 mx-auto mb-3" style={{ color: "var(--text-muted)" }} />
                                        <p className="font-semibold mb-1" style={{ color: "var(--text-primary)" }}>No employees yet</p>
                                        <p className="text-sm mb-4" style={{ color: "var(--text-muted)" }}>
                                            Add an employee to start generating payslips.
                                        </p>
                                        <Link href="/employees/new">
                                            <Button className="gap-2">
                                                Add Employee <ArrowRight className="h-4 w-4" />
                                            </Button>
                                        </Link>
                                    </CardContent>
                                </Card>
                            ) : (
                                summaries.map(({ employee, lastPayslip, netPay }) => (
                                    <Card key={employee.id} className="animate-slide-up">
                                        <CardContent className="p-4">
                                            <div className="flex items-center justify-between mb-3">
                                                <div className="flex items-center gap-3">
                                                    <div
                                                        className="h-10 w-10 rounded-full flex items-center justify-center text-sm font-bold"
                                                        style={{ backgroundColor: "var(--amber-500)", color: "var(--text-inverse)" }}
                                                    >
                                                        {employee.name.charAt(0).toUpperCase()}
                                                    </div>
                                                    <div>
                                                        <p className="font-semibold text-sm" style={{ color: "var(--text-primary)" }}>
                                                            {employee.name}
                                                        </p>
                                                        <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                                                            {employee.role} · R{employee.hourlyRate.toFixed(2)}/hr
                                                        </p>
                                                    </div>
                                                </div>
                                                {netPay !== null && (
                                                    <div className="text-right">
                                                        <p className="text-sm font-bold tabular-nums" style={{ color: "var(--text-primary)" }}>
                                                            R {netPay.toFixed(2)}
                                                        </p>
                                                        <p className="text-xs" style={{ color: "var(--text-muted)" }}>last net</p>
                                                    </div>
                                                )}
                                            </div>

                                            {lastPayslip ? (
                                                <div className="flex items-center gap-2">
                                                    <p className="flex-1 text-xs flex items-center gap-1" style={{ color: "var(--text-muted)" }}>
                                                        <CalendarDays className="h-3.5 w-3.5" />
                                                        {format(new Date(lastPayslip.payPeriodStart), "d MMM")} –{" "}
                                                        {format(new Date(lastPayslip.payPeriodEnd), "d MMM yyyy")}
                                                    </p>
                                                    <Button
                                                        size="sm"
                                                        className="gap-1.5 text-xs"
                                                        onClick={() => handleRepeat(employee.id)}
                                                    >
                                                        <RefreshCw className="h-3.5 w-3.5" />
                                                        Repeat
                                                    </Button>
                                                </div>
                                            ) : (
                                                <Link href={`/wizard?employeeId=${employee.id}`}>
                                                    <Button size="sm" variant="outline" className="w-full gap-1.5 text-xs">
                                                        Create First Payslip <ChevronRight className="h-3.5 w-3.5" />
                                                    </Button>
                                                </Link>
                                            )}
                                        </CardContent>
                                    </Card>
                                ))
                            )}
                        </div>
                    </>
                )}
            </main>
        </div>
    );
}
</file>

<file path="app/employees/new/page.tsx">
"use client";

import * as React from "react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { ArrowLeft, Loader2, Save } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Card, CardContent } from "@/components/ui/card";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { SideDrawer } from "@/components/layout/side-drawer";
import { EmployeeSchema, Employee } from "@/lib/schema";
import { saveEmployee } from "@/lib/storage";
import { NMW_RATE } from "@/lib/calculator";

export default function AddEmployeePage() {
    const router = useRouter();
    const [loading, setLoading] = React.useState(false);
    const [formData, setFormData] = React.useState({
        name: "",
        idNumber: "",
        hourlyRate: NMW_RATE.toString(),
        role: "Domestic Worker",
        phone: "",
        startDate: new Date().toISOString().slice(0, 10),
    });
    const [errors, setErrors] = React.useState<Record<string, string>>({});

    const hourlyRateNum = parseFloat(formData.hourlyRate) || 0;
    const belowNMW = hourlyRateNum > 0 && hourlyRateNum < NMW_RATE;

    const handleSave = async (e: React.FormEvent) => {
        e.preventDefault();
        setErrors({});

        const submissionData = {
            id: crypto.randomUUID(),
            ...formData,
            hourlyRate: parseFloat(formData.hourlyRate),
        };

        const parsed = EmployeeSchema.safeParse(submissionData);
        if (!parsed.success) {
            const fieldErrors: Record<string, string> = {};
            parsed.error.issues.forEach((err) => {
                if (err.path[0]) fieldErrors[err.path[0].toString()] = err.message;
            });
            setErrors(fieldErrors);
            return;
        }

        setLoading(true);
        try {
            await saveEmployee(parsed.data as Employee);
            router.push("/employees");
        } catch (err) {
            console.error(err);
            setErrors({ form: "Failed to save. Please try again." });
            setLoading(false);
        }
    };

    return (
        <div className="min-h-screen flex flex-col" style={{ backgroundColor: "var(--bg-base)" }}>
            {/* Header */}
            <header
                className="sticky top-0 z-30 px-4 py-3"
                style={{
                    backgroundColor: "var(--bg-surface)",
                    borderBottom: "1px solid var(--border-subtle)",
                    boxShadow: "var(--shadow-sm)",
                }}
            >
                <div className="max-w-xl mx-auto flex items-center gap-3">
                    <SideDrawer />
                    <Link href="/employees">
                        <button
                            aria-label="Back"
                            className="h-9 w-9 flex items-center justify-center rounded-xl transition-colors hover:bg-[var(--bg-subtle)]"
                            style={{ color: "var(--text-secondary)" }}
                        >
                            <ArrowLeft className="h-4 w-4" />
                        </button>
                    </Link>
                    <h1 className="font-bold text-base tracking-tight" style={{ color: "var(--text-primary)" }}>
                        Add Employee
                    </h1>
                </div>
            </header>

            <main className="flex-1 max-w-xl mx-auto w-full px-4 py-6">
                <Card className="animate-slide-up">
                    <CardContent className="p-6">
                        <form onSubmit={handleSave} className="space-y-5">
                            {errors.form && (
                                <Alert variant="error">
                                    <AlertDescription>{errors.form}</AlertDescription>
                                </Alert>
                            )}

                            <div className="space-y-2">
                                <Label htmlFor="name">Full Name *</Label>
                                <Input
                                    id="name"
                                    placeholder="e.g. Thandi Dlamini"
                                    value={formData.name}
                                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                    error={errors.name}
                                    disabled={loading}
                                    autoFocus
                                />
                            </div>

                            <div className="space-y-2">
                                <Label htmlFor="role">Role</Label>
                                <Input
                                    id="role"
                                    placeholder="e.g. Domestic Worker, Gardener"
                                    value={formData.role}
                                    onChange={(e) => setFormData({ ...formData, role: e.target.value })}
                                    error={errors.role}
                                    disabled={loading}
                                />
                            </div>

                            <div className="space-y-2">
                                <Label htmlFor="idNumber">ID / Passport Number (Optional)</Label>
                                <Input
                                    id="idNumber"
                                    placeholder="e.g. 9001015009087"
                                    value={formData.idNumber}
                                    onChange={(e) => setFormData({ ...formData, idNumber: e.target.value })}
                                    error={errors.idNumber}
                                    disabled={loading}
                                />
                                <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                                    Stored on-device only. Used on the payslip PDF.
                                </p>
                            </div>

                            <div className="grid grid-cols-2 gap-3">
                                <div className="space-y-2">
                                    <Label htmlFor="phone">Phone Number</Label>
                                    <Input
                                        id="phone"
                                        type="tel"
                                        placeholder="e.g. 071 234 5678"
                                        value={formData.phone}
                                        onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
                                        disabled={loading}
                                    />
                                    <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                                        For WhatsApp sharing of payslips.
                                    </p>
                                </div>
                                <div className="space-y-2">
                                    <Label htmlFor="startDate">Employment Start</Label>
                                    <Input
                                        id="startDate"
                                        type="date"
                                        value={formData.startDate}
                                        onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}
                                        disabled={loading}
                                    />
                                    <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                                        Used to calculate leave.
                                    </p>
                                </div>
                            </div>

                            <div className="space-y-2">
                                <Label htmlFor="hourlyRate">Default Hourly Rate (ZAR) *</Label>
                                <div className="relative">
                                    <span
                                        className="absolute left-4 top-3 text-sm font-semibold pointer-events-none"
                                        style={{ color: "var(--text-muted)" }}
                                    >
                                        R
                                    </span>
                                    <Input
                                        id="hourlyRate"
                                        className="pl-8"
                                        type="number"
                                        step="0.01"
                                        placeholder={NMW_RATE.toString()}
                                        value={formData.hourlyRate}
                                        onChange={(e) => setFormData({ ...formData, hourlyRate: e.target.value })}
                                        error={errors.hourlyRate}
                                        disabled={loading}
                                    />
                                </div>
                                {belowNMW && (
                                    <Alert variant="error">
                                        <AlertDescription>
                                            National Minimum Wage is <strong>R{NMW_RATE}/hr</strong> for Domestic
                                            Workers (SD7). You cannot legally pay below this.
                                        </AlertDescription>
                                    </Alert>
                                )}
                                {!belowNMW && hourlyRateNum >= NMW_RATE && (
                                    <p className="text-xs" style={{ color: "var(--green-500)" }}>
                                        ✓ Above National Minimum Wage
                                    </p>
                                )}
                            </div>

                            <div
                                className="pt-4"
                                style={{ borderTop: "1px solid var(--border-subtle)" }}
                            >
                                <Button
                                    type="submit"
                                    className="w-full gap-2 h-12 text-base"
                                    disabled={loading || belowNMW}
                                >
                                    {loading ? (
                                        <>
                                            <Loader2 className="h-5 w-5 animate-spin" /> Saving…
                                        </>
                                    ) : (
                                        <>
                                            <Save className="h-4 w-4" /> Save Employee
                                        </>
                                    )}
                                </Button>
                            </div>
                        </form>
                    </CardContent>
                </Card>
            </main>
        </div>
    );
}
</file>

<file path="app/employees/page.tsx">
"use client";

import * as React from "react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { ArrowLeft, Plus, Trash2, Loader2, Users, ChevronRight, Palmtree } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { SideDrawer } from "@/components/layout/side-drawer";
import { getEmployees, deleteEmployee } from "@/lib/storage";
import { Employee } from "@/lib/schema";

export default function EmployeesPage() {
    const router = useRouter();
    const [employees, setEmployees] = React.useState<Employee[]>([]);
    const [loading, setLoading] = React.useState(true);
    const [confirmDelete, setConfirmDelete] = React.useState<string | null>(null);

    const load = React.useCallback(async () => {
        setLoading(true);
        try {
            const data = await getEmployees();
            setEmployees(data);
        } finally {
            setLoading(false);
        }
    }, []);

    React.useEffect(() => { load(); }, [load]);

    const handleDelete = async (id: string) => {
        await deleteEmployee(id);
        setConfirmDelete(null);
        load();
    };

    return (
        <div className="min-h-screen flex flex-col" style={{ backgroundColor: "var(--bg-base)" }}>
            {/* Header */}
            <header
                className="sticky top-0 z-30 px-4 py-3"
                style={{
                    backgroundColor: "var(--bg-surface)",
                    borderBottom: "1px solid var(--border-subtle)",
                    boxShadow: "var(--shadow-sm)",
                }}
            >
                <div className="max-w-xl mx-auto flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <SideDrawer />
                        <Link href="/">
                            <button
                                aria-label="Go home"
                                className="h-9 w-9 flex items-center justify-center rounded-xl transition-colors hover:bg-[var(--bg-subtle)]"
                                style={{ color: "var(--text-secondary)" }}
                            >
                                <ArrowLeft className="h-4 w-4" />
                            </button>
                        </Link>
                        <h1 className="font-bold text-base tracking-tight" style={{ color: "var(--text-primary)" }}>
                            Employees
                        </h1>
                    </div>
                    <Link href="/employees/new">
                        <Button size="sm" className="gap-1.5" id="add-employee-btn">
                            <Plus className="h-4 w-4" /> Add
                        </Button>
                    </Link>
                </div>
            </header>

            <main className="flex-1 max-w-xl mx-auto w-full px-4 py-6 space-y-4">
                {loading && (
                    <div className="flex items-center justify-center py-20">
                        <Loader2 className="h-8 w-8 animate-spin" style={{ color: "var(--amber-500)" }} />
                    </div>
                )}

                {!loading && employees.length === 0 && (
                    <div className="flex flex-col items-center justify-center py-20 text-center space-y-4 animate-fade-in">
                        <div
                            className="h-16 w-16 rounded-2xl flex items-center justify-center"
                            style={{ backgroundColor: "rgba(196,122,28,0.10)" }}
                        >
                            <Users className="h-8 w-8" style={{ color: "var(--amber-500)" }} />
                        </div>
                        <div className="space-y-1">
                            <p className="font-bold text-lg" style={{ color: "var(--text-primary)" }}>
                                No employees yet
                            </p>
                            <p className="text-sm" style={{ color: "var(--text-secondary)" }}>
                                Add your first domestic worker to get started.
                            </p>
                        </div>
                        <Link href="/employees/new">
                            <Button className="gap-2 mt-2">
                                <Plus className="h-4 w-4" /> Add Employee
                            </Button>
                        </Link>
                    </div>
                )}

                {!loading && employees.length > 0 && (
                    <div className="space-y-3 animate-slide-up">
                        {employees.map((emp, i) => (
                            <Card
                                key={emp.id}
                                className="animate-slide-up"
                                style={{ animationDelay: `${i * 60}ms` }}
                            >
                                <CardContent className="p-4">
                                    <div className="flex items-center gap-3">
                                        {/* Avatar */}
                                        <div
                                            className="h-11 w-11 rounded-xl flex items-center justify-center text-white font-bold text-base flex-shrink-0"
                                            style={{ backgroundColor: "var(--amber-500)" }}
                                        >
                                            {emp.name.charAt(0).toUpperCase()}
                                        </div>
                                        {/* Info */}
                                        <div className="flex-1 min-w-0">
                                            <p className="font-semibold text-sm truncate" style={{ color: "var(--text-primary)" }}>
                                                {emp.name}
                                            </p>
                                            <p className="text-xs truncate" style={{ color: "var(--text-secondary)" }}>
                                                {emp.role} · R{emp.hourlyRate.toFixed(2)}/hr
                                            </p>
                                        </div>
                                        {/* Actions */}
                                        <div className="flex items-center gap-2 flex-shrink-0">
                                            <Button
                                                size="sm"
                                                variant="outline"
                                                className="gap-1 text-xs"
                                                onClick={() => router.push(`/leave?employeeId=${emp.id}`)}
                                            >
                                                <Palmtree className="h-3.5 w-3.5" /> Leave
                                            </Button>
                                            <Button
                                                size="sm"
                                                variant="default"
                                                className="gap-1.5 text-xs"
                                                onClick={() => router.push(`/wizard?empId=${emp.id}`)}
                                            >
                                                Payslip <ChevronRight className="h-3.5 w-3.5" />
                                            </Button>
                                            <button
                                                onClick={() => setConfirmDelete(emp.id)}
                                                aria-label={`Delete ${emp.name}`}
                                                className="h-8 w-8 flex items-center justify-center rounded-lg transition-colors hover:bg-[var(--red-50)]"
                                                style={{ color: "var(--text-muted)" }}
                                            >
                                                <Trash2 className="h-4 w-4" />
                                            </button>
                                        </div>
                                    </div>

                                    {/* Inline delete confirmation */}
                                    {confirmDelete === emp.id && (
                                        <div
                                            className="mt-3 pt-3 flex items-center justify-between gap-2 animate-slide-down"
                                            style={{ borderTop: "1px solid var(--border-subtle)" }}
                                        >
                                            <p className="text-xs" style={{ color: "var(--text-secondary)" }}>
                                                Delete {emp.name}? This can&#39;t be undone.
                                            </p>
                                            <div className="flex gap-2">
                                                <Button size="sm" variant="outline" onClick={() => setConfirmDelete(null)}>
                                                    Cancel
                                                </Button>
                                                <Button size="sm" variant="danger" onClick={() => handleDelete(emp.id)}>
                                                    Delete
                                                </Button>
                                            </div>
                                        </div>
                                    )}
                                </CardContent>
                            </Card>
                        ))}
                    </div>
                )}

                <Alert variant="default" className="mt-6">
                    <AlertDescription>
                        Data is stored only on this device. Nothing is sent to any server.
                    </AlertDescription>
                </Alert>
            </main>
        </div>
    );
}
</file>

<file path="app/leave/page.tsx">
"use client";

import * as React from "react";
import Link from "next/link";
import { useSearchParams } from "next/navigation";
import {
    ArrowLeft, Loader2, Palmtree, Thermometer, Heart, CalendarDays,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { SideDrawer } from "@/components/layout/side-drawer";
import { getEmployee, getLeaveForEmployee } from "@/lib/storage";
import { Employee, LeaveRecord } from "@/lib/schema";
import { calculateLeaveBalances, LeaveBalances } from "@/lib/leave";

function LeaveCard({
    icon: Icon,
    label,
    accrued,
    taken,
    remaining,
    color,
}: {
    icon: React.ElementType;
    label: string;
    accrued: number;
    taken: number;
    remaining: number;
    color: string;
}) {
    const pct = accrued > 0 ? Math.min(100, (remaining / accrued) * 100) : 0;
    return (
        <Card className="animate-slide-up">
            <CardContent className="p-5">
                <div className="flex items-center gap-3 mb-4">
                    <div
                        className="h-10 w-10 rounded-xl flex items-center justify-center"
                        style={{ backgroundColor: `${color}18` }}
                    >
                        <Icon className="h-5 w-5" style={{ color }} />
                    </div>
                    <div>
                        <p className="text-sm font-bold" style={{ color: "var(--text-primary)" }}>{label}</p>
                        <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                            {remaining.toFixed(1)} days remaining
                        </p>
                    </div>
                </div>

                {/* Progress bar */}
                <div className="w-full h-2.5 rounded-full overflow-hidden mb-3" style={{ backgroundColor: "var(--bg-subtle)" }}>
                    <div
                        className="h-full rounded-full transition-all duration-500"
                        style={{ width: `${pct}%`, backgroundColor: color }}
                    />
                </div>

                <div className="flex justify-between text-xs" style={{ color: "var(--text-muted)" }}>
                    <span>Accrued: {accrued.toFixed(1)}d</span>
                    <span>Taken: {taken.toFixed(1)}d</span>
                </div>
            </CardContent>
        </Card>
    );
}

function LeaveContent() {
    const searchParams = useSearchParams();
    const employeeId = searchParams.get("employeeId") || "";
    const [loading, setLoading] = React.useState(true);
    const [employee, setEmployee] = React.useState<Employee | null>(null);
    const [balances, setBalances] = React.useState<LeaveBalances | null>(null);
    const [records, setRecords] = React.useState<LeaveRecord[]>([]);

    React.useEffect(() => {
        async function load() {
            if (!employeeId) { setLoading(false); return; }
            const emp = await getEmployee(employeeId);
            setEmployee(emp);
            if (emp) {
                const leaveRecords = await getLeaveForEmployee(employeeId);
                setRecords(leaveRecords);
                const bal = calculateLeaveBalances(emp.startDate || "", leaveRecords);
                setBalances(bal);
            }
            setLoading(false);
        }
        load();
    }, [employeeId]);

    if (loading) {
        return (
            <div className="flex items-center justify-center py-20">
                <Loader2 className="h-6 w-6 animate-spin" style={{ color: "var(--amber-500)" }} />
            </div>
        );
    }

    if (!employee) {
        return (
            <div className="text-center py-20">
                <p className="font-semibold mb-2" style={{ color: "var(--text-primary)" }}>Employee not found</p>
                <Link href="/employees"><Button variant="outline">Back to Employees</Button></Link>
            </div>
        );
    }

    if (!employee.startDate) {
        return (
            <div className="text-center py-20 px-4 space-y-4">
                <CalendarDays className="h-12 w-12 mx-auto" style={{ color: "var(--text-muted)" }} />
                <p className="font-semibold" style={{ color: "var(--text-primary)" }}>No Start Date Set</p>
                <p className="text-sm max-w-sm mx-auto" style={{ color: "var(--text-muted)" }}>
                    To calculate leave balances, we need to know when {employee.name} started working.
                    Edit their profile to add a start date.
                </p>
                <Link href="/employees">
                    <Button variant="outline" className="gap-2">
                        <ArrowLeft className="h-4 w-4" /> Back to Employees
                    </Button>
                </Link>
            </div>
        );
    }

    return (
        <div className="space-y-4">
            {/* Employee header */}
            <div className="flex items-center gap-3 mb-2">
                <div
                    className="h-12 w-12 rounded-full flex items-center justify-center text-lg font-bold"
                    style={{ backgroundColor: "var(--amber-500)", color: "var(--text-inverse)" }}
                >
                    {employee.name.charAt(0).toUpperCase()}
                </div>
                <div>
                    <p className="font-bold" style={{ color: "var(--text-primary)" }}>{employee.name}</p>
                    <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                        Employed since {new Date(employee.startDate).toLocaleDateString("en-ZA", { year: "numeric", month: "long", day: "numeric" })}
                    </p>
                </div>
            </div>

            {/* Leave balance cards */}
            {balances && (
                <div className="space-y-3">
                    <LeaveCard
                        icon={Palmtree}
                        label="Annual Leave"
                        accrued={balances.annual.accrued}
                        taken={balances.annual.taken}
                        remaining={balances.annual.remaining}
                        color="#c47a1c"
                    />
                    <LeaveCard
                        icon={Thermometer}
                        label="Sick Leave"
                        accrued={balances.sick.accrued}
                        taken={balances.sick.taken}
                        remaining={balances.sick.remaining}
                        color="#3b82f6"
                    />
                    <LeaveCard
                        icon={Heart}
                        label="Family Responsibility"
                        accrued={balances.family.accrued}
                        taken={balances.family.taken}
                        remaining={balances.family.remaining}
                        color="#10b981"
                    />
                </div>
            )}

            {/* Leave history */}
            {records.length > 0 && (
                <Card>
                    <CardContent className="p-4">
                        <h3 className="text-sm font-bold mb-3" style={{ color: "var(--text-primary)" }}>
                            Leave History
                        </h3>
                        <div className="space-y-2">
                            {records.map((r) => (
                                <div
                                    key={r.id}
                                    className="flex items-center justify-between py-2 text-sm"
                                    style={{ borderBottom: "1px solid var(--border-subtle)" }}
                                >
                                    <div className="flex items-center gap-2">
                                        <span
                                            className="h-2 w-2 rounded-full"
                                            style={{
                                                backgroundColor:
                                                    r.type === "annual" ? "#c47a1c" :
                                                        r.type === "sick" ? "#3b82f6" : "#10b981",
                                            }}
                                        />
                                        <span style={{ color: "var(--text-primary)" }}>
                                            {r.type.charAt(0).toUpperCase() + r.type.slice(1)}
                                        </span>
                                    </div>
                                    <div className="flex items-center gap-4 text-xs" style={{ color: "var(--text-muted)" }}>
                                        <span>{r.days}d</span>
                                        <span>{new Date(r.date).toLocaleDateString("en-ZA")}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </CardContent>
                </Card>
            )}

            <p className="text-xs text-center" style={{ color: "var(--text-muted)" }}>
                Leave is calculated per BCEA &amp; Sectoral Determination 7.
                Leave taken via the payslip wizard is automatically logged here.
            </p>
        </div>
    );
}

export default function LeavePage() {
    return (
        <div className="min-h-screen flex flex-col" style={{ backgroundColor: "var(--bg-base)" }}>
            <header
                className="sticky top-0 z-30 px-4 py-3"
                style={{
                    backgroundColor: "var(--bg-surface)",
                    borderBottom: "1px solid var(--border-subtle)",
                    boxShadow: "var(--shadow-sm)",
                }}
            >
                <div className="max-w-xl mx-auto flex items-center gap-3">
                    <SideDrawer />
                    <Link href="/employees">
                        <button
                            aria-label="Back"
                            className="h-9 w-9 flex items-center justify-center rounded-xl transition-colors hover:bg-[var(--bg-subtle)]"
                            style={{ color: "var(--text-secondary)" }}
                        >
                            <ArrowLeft className="h-4 w-4" />
                        </button>
                    </Link>
                    <h1 className="font-bold text-base tracking-tight" style={{ color: "var(--text-primary)" }}>
                        Leave Tracker
                    </h1>
                </div>
            </header>
            <main className="flex-1 max-w-xl mx-auto w-full px-4 py-6">
                <React.Suspense
                    fallback={
                        <div className="flex items-center justify-center py-20">
                            <Loader2 className="h-6 w-6 animate-spin" style={{ color: "var(--amber-500)" }} />
                        </div>
                    }
                >
                    <LeaveContent />
                </React.Suspense>
            </main>
        </div>
    );
}
</file>

<file path="app/preview/page.tsx">
"use client";

import * as React from "react";
import Link from "next/link";
import { useSearchParams } from "next/navigation";
import { ArrowLeft, Download, Loader2, CheckCircle2, RefreshCw, MessageCircle } from "lucide-react";
import { format } from "date-fns";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { SideDrawer } from "@/components/layout/side-drawer";
import { getEmployees, getPayslipsForEmployee } from "@/lib/storage";
import { Employee, PayslipInput } from "@/lib/schema";
import { calculatePayslip } from "@/lib/calculator";
import { generatePayslipPdfBytes } from "@/lib/pdf";
import { shareViaWhatsApp } from "@/lib/share";

function Row({ label, value, bold, red }: { label: string; value: string; bold?: boolean; red?: boolean }) {
    return (
        <div className="flex justify-between items-center py-2.5 text-sm" style={{ borderBottom: "1px solid var(--border-subtle)" }}>
            <span style={{ color: bold ? "var(--text-primary)" : "var(--text-secondary)", fontWeight: bold ? 600 : 400 }}>
                {label}
            </span>
            <span
                className="tabular-nums font-medium"
                style={{ color: red ? "var(--red-500)" : bold ? "var(--text-primary)" : "var(--text-secondary)", fontWeight: bold ? 700 : 500 }}
            >
                {value}
            </span>
        </div>
    );
}

function PreviewContent() {
    const searchParams = useSearchParams();
    const payslipId = searchParams?.get("payslipId");
    const empId = searchParams?.get("empId");

    const [employee, setEmployee] = React.useState<Employee | null>(null);
    const [payslip, setPayslip] = React.useState<PayslipInput | null>(null);
    const [loading, setLoading] = React.useState(true);
    const [downloading, setDownloading] = React.useState(false);
    const [sharing, setSharing] = React.useState(false);
    const [error, setError] = React.useState("");

    React.useEffect(() => {
        async function load() {
            if (!payslipId || !empId) { setError("Payslip not found."); setLoading(false); return; }

            try {
                const [empList, payslips] = await Promise.all([
                    getEmployees(),
                    getPayslipsForEmployee(empId),
                ]);
                const emp = empList.find((e) => e.id === empId);
                const ps = payslips.find((p) => p.id === payslipId);

                if (!emp || !ps) { setError("Payslip data not found."); }
                else { setEmployee(emp); setPayslip(ps); }
            } catch (e) {
                console.error(e);
                setError("Failed to load payslip data.");
            } finally {
                setLoading(false);
            }
        }
        load();
    }, [payslipId, empId]);

    const handleDownload = async () => {
        if (!employee || !payslip) return;
        setDownloading(true);
        try {
            const bytes = await generatePayslipPdfBytes(employee, payslip);
            // Create a proper copy of the buffer to avoid SharedArrayBuffer issues
            const copy = bytes.slice(0);
            const blob = new Blob([copy], { type: "application/pdf" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = `Payslip_${employee.name.replace(/\s+/g, "_")}_${format(payslip.payPeriodStart, "MMM_yyyy")}.pdf`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        } catch (e) {
            console.error("PDF generation failed:", e);
            setError("Failed to generate PDF. Please try again.");
        } finally {
            setDownloading(false);
        }
    };

    if (loading) {
        return (
            <div className="min-h-screen flex items-center justify-center" style={{ backgroundColor: "var(--bg-base)" }}>
                <Loader2 className="h-8 w-8 animate-spin" style={{ color: "var(--amber-500)" }} />
            </div>
        );
    }

    if (error || !employee || !payslip) {
        return (
            <div className="min-h-screen flex flex-col" style={{ backgroundColor: "var(--bg-base)" }}>
                <div className="max-w-xl mx-auto w-full px-4 py-12">
                    <Alert variant="error">
                        <AlertDescription>{error || "Something went wrong."}</AlertDescription>
                    </Alert>
                    <Link href="/employees" className="mt-4 block">
                        <Button variant="outline" className="gap-2">
                            <ArrowLeft className="h-4 w-4" /> Back to Employees
                        </Button>
                    </Link>
                </div>
            </div>
        );
    }

    const breakdown = calculatePayslip(payslip);
    const periodStr = `${format(payslip.payPeriodStart, "d MMM")} – ${format(payslip.payPeriodEnd, "d MMM yyyy")}`;

    return (
        <div className="min-h-screen flex flex-col" style={{ backgroundColor: "var(--bg-base)" }}>
            {/* Header */}
            <header
                className="sticky top-0 z-30 px-4 py-3"
                style={{
                    backgroundColor: "var(--bg-surface)",
                    borderBottom: "1px solid var(--border-subtle)",
                    boxShadow: "var(--shadow-sm)",
                }}
            >
                <div className="max-w-xl mx-auto flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <SideDrawer />
                        <Link href="/employees">
                            <button
                                aria-label="Back"
                                className="h-9 w-9 flex items-center justify-center rounded-xl transition-colors hover:bg-[var(--bg-subtle)]"
                                style={{ color: "var(--text-secondary)" }}
                            >
                                <ArrowLeft className="h-4 w-4" />
                            </button>
                        </Link>
                        <h1 className="font-bold text-base" style={{ color: "var(--text-primary)" }}>
                            Payslip Preview
                        </h1>
                    </div>
                    <Button
                        onClick={handleDownload}
                        disabled={downloading}
                        className="gap-2"
                        size="sm"
                    >
                        {downloading ? (
                            <><Loader2 className="h-4 w-4 animate-spin" /> Generating…</>
                        ) : (
                            <><Download className="h-4 w-4" /> Download PDF</>
                        )}
                    </Button>
                </div>
            </header>

            <main className="flex-1 max-w-xl mx-auto w-full px-4 py-6 space-y-5">
                {/* Success banner */}
                <Alert variant="success" className="animate-slide-down">
                    <AlertDescription>
                        Payslip generated successfully for <strong>{employee.name}</strong>. Download the PDF below.
                    </AlertDescription>
                </Alert>

                {/* Employee identity card */}
                <Card className="animate-slide-up">
                    <CardContent className="p-5">
                        <div className="flex items-center gap-4">
                            <div
                                className="h-14 w-14 rounded-2xl flex items-center justify-center text-white font-black text-xl flex-shrink-0"
                                style={{ backgroundColor: "var(--amber-500)" }}
                            >
                                {employee.name.charAt(0).toUpperCase()}
                            </div>
                            <div className="flex-1 min-w-0">
                                <p className="font-bold text-lg leading-tight truncate" style={{ color: "var(--text-primary)" }}>
                                    {employee.name}
                                </p>
                                <p className="text-sm" style={{ color: "var(--text-secondary)" }}>
                                    {employee.role}
                                </p>
                                {employee.idNumber && (
                                    <p className="text-xs mt-0.5" style={{ color: "var(--text-muted)" }}>
                                        ID: {employee.idNumber}
                                    </p>
                                )}
                            </div>
                            <div className="text-right flex-shrink-0">
                                <p className="text-xs font-semibold" style={{ color: "var(--text-muted)" }}>PAY PERIOD</p>
                                <p className="text-sm font-semibold mt-0.5" style={{ color: "var(--text-primary)" }}>{periodStr}</p>
                                <p className="text-xs mt-0.5" style={{ color: "var(--text-muted)" }}>R{employee.hourlyRate.toFixed(2)}/hr</p>
                            </div>
                        </div>
                    </CardContent>
                </Card>

                {/* Payslip breakdown */}
                <Card className="animate-slide-up delay-100">
                    <CardContent className="p-5">
                        <p
                            className="text-xs font-bold uppercase tracking-widest mb-3"
                            style={{ color: "var(--amber-500)" }}
                        >
                            Earnings
                        </p>
                        <Row label={`Ordinary (${payslip.ordinaryHours}h)`} value={`R ${breakdown.ordinaryPay.toFixed(2)}`} />
                        {payslip.overtimeHours > 0 && <Row label={`Overtime (${payslip.overtimeHours}h × 1.5)`} value={`R ${breakdown.overtimePay.toFixed(2)}`} />}
                        {payslip.sundayHours > 0 && <Row label={`Sunday (${payslip.sundayHours}h × 2)`} value={`R ${breakdown.sundayPay.toFixed(2)}`} />}
                        {payslip.publicHolidayHours > 0 && <Row label={`Public Holiday (${payslip.publicHolidayHours}h × 2)`} value={`R ${breakdown.publicHolidayPay.toFixed(2)}`} />}
                        <Row label="Gross Pay" value={`R ${breakdown.grossPay.toFixed(2)}`} bold />

                        <p
                            className="text-xs font-bold uppercase tracking-widest mt-5 mb-3"
                            style={{ color: "var(--amber-500)" }}
                        >
                            Deductions
                        </p>
                        <Row
                            label={`UIF ${breakdown.totalHours > 24 ? "(1%)" : "(not applicable ≤24hrs)"}`}
                            value={`-R ${breakdown.deductions.uifEmployee.toFixed(2)}`}
                            red
                        />
                        {payslip.includeAccommodation && breakdown.deductions.accommodation && (
                            <Row label="Accommodation (10%)" value={`-R ${breakdown.deductions.accommodation.toFixed(2)}`} red />
                        )}
                        <Row label="Total Deductions" value={`R ${breakdown.deductions.total.toFixed(2)}`} bold />
                    </CardContent>

                    {/* Net Pay */}
                    <div
                        className="flex items-center justify-between px-5 py-5 rounded-b-2xl"
                        style={{ backgroundColor: "var(--amber-500)" }}
                    >
                        <div>
                            <p className="text-white font-bold text-lg">Net Pay</p>
                            <p className="text-white/70 text-xs">Employee takes home</p>
                        </div>
                        <p className="text-white font-extrabold text-3xl tabular-nums">
                            R {breakdown.netPay.toFixed(2)}
                        </p>
                    </div>
                </Card>

                {/* Employer contribution note */}
                <Card className="animate-slide-up delay-200">
                    <CardContent className="p-4">
                        <p className="text-xs font-bold uppercase tracking-widest mb-2" style={{ color: "var(--text-muted)" }}>
                            Employer Record (not deducted from worker)
                        </p>
                        <div className="flex justify-between text-sm">
                            <span style={{ color: "var(--text-secondary)" }}>UIF — Employer contribution (1%)</span>
                            <span className="font-semibold tabular-nums" style={{ color: "var(--text-primary)" }}>
                                R {breakdown.employerContributions.uifEmployer.toFixed(2)}
                            </span>
                        </div>
                    </CardContent>
                </Card>

                {/* Actions */}
                <div className="flex flex-col gap-3 animate-slide-up delay-300 pb-6">
                    <Button
                        size="lg"
                        onClick={handleDownload}
                        disabled={downloading}
                        className="w-full gap-2 h-12 text-base font-bold"
                    >
                        {downloading ? (
                            <><Loader2 className="h-5 w-5 animate-spin" /> Generating PDF…</>
                        ) : (
                            <><Download className="h-5 w-5" /> Download PDF</>
                        )}
                    </Button>

                    {/* WhatsApp Share */}
                    <Button
                        size="lg"
                        variant="outline"
                        className="w-full gap-2 h-12 text-base"
                        disabled={sharing}
                        onClick={async () => {
                            if (!employee || !payslip) return;
                            setSharing(true);
                            try {
                                const bytes = await generatePayslipPdfBytes(employee, payslip);
                                const periodLabel = format(payslip.payPeriodStart, "MMM_yyyy");
                                await shareViaWhatsApp(bytes.slice(0), employee.name, employee.phone || "", periodLabel);
                            } catch (e) {
                                console.error("Share failed:", e);
                            }
                            setSharing(false);
                        }}
                        style={{ borderColor: "#25D366", color: "#25D366" }}
                    >
                        {sharing ? (
                            <><Loader2 className="h-5 w-5 animate-spin" /> Sharing…</>
                        ) : (
                            <><MessageCircle className="h-5 w-5" /> Share via WhatsApp</>
                        )}
                    </Button>

                    <Link href={`/wizard?empId=${employee.id}`}>
                        <Button size="lg" variant="outline" className="w-full gap-2">
                            <RefreshCw className="h-4 w-4" /> New Payslip for {employee.name.split(" ")[0]}
                        </Button>
                    </Link>

                    <Link href="/employees">
                        <Button size="lg" variant="ghost" className="w-full gap-2">
                            <CheckCircle2 className="h-4 w-4" /> Done
                        </Button>
                    </Link>
                </div>
            </main>
        </div>
    );
}

export default function PreviewPage() {
    return (
        <React.Suspense
            fallback={
                <div className="min-h-screen flex items-center justify-center" style={{ backgroundColor: "var(--bg-base)" }}>
                    <Loader2 className="h-8 w-8 animate-spin" style={{ color: "var(--amber-500)" }} />
                </div>
            }
        >
            <PreviewContent />
        </React.Suspense>
    );
}
</file>

<file path="app/settings/page.tsx">
"use client";

import * as React from "react";
import Link from "next/link";
import { ArrowLeft, Save, Loader2, Building2, CheckCircle2 } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { SideDrawer } from "@/components/layout/side-drawer";
import { getSettings, saveSettings } from "@/lib/storage";
import { EmployerSettings } from "@/lib/schema";

export default function SettingsPage() {
    const [loading, setLoading] = React.useState(true);
    const [saving, setSaving] = React.useState(false);
    const [saved, setSaved] = React.useState(false);
    const [form, setForm] = React.useState<EmployerSettings>({
        employerName: "",
        employerAddress: "",
        employerIdNumber: "",
        uifRefNumber: "",
        sdlNumber: "",
    });

    React.useEffect(() => {
        async function load() {
            const s = await getSettings();
            setForm(s);
            setLoading(false);
        }
        load();
    }, []);

    const handleSave = async (e: React.FormEvent) => {
        e.preventDefault();
        setSaving(true);
        setSaved(false);
        await saveSettings(form);
        setSaving(false);
        setSaved(true);
        setTimeout(() => setSaved(false), 3000);
    };

    return (
        <div className="min-h-screen flex flex-col" style={{ backgroundColor: "var(--bg-base)" }}>
            <header
                className="sticky top-0 z-30 px-4 py-3"
                style={{
                    backgroundColor: "var(--bg-surface)",
                    borderBottom: "1px solid var(--border-subtle)",
                    boxShadow: "var(--shadow-sm)",
                }}
            >
                <div className="max-w-xl mx-auto flex items-center gap-3">
                    <SideDrawer />
                    <Link href="/dashboard">
                        <button
                            aria-label="Back"
                            className="h-9 w-9 flex items-center justify-center rounded-xl transition-colors hover:bg-[var(--bg-subtle)]"
                            style={{ color: "var(--text-secondary)" }}
                        >
                            <ArrowLeft className="h-4 w-4" />
                        </button>
                    </Link>
                    <h1 className="font-bold text-base tracking-tight" style={{ color: "var(--text-primary)" }}>
                        Settings
                    </h1>
                </div>
            </header>

            <main className="flex-1 max-w-xl mx-auto w-full px-4 py-6 space-y-5">
                {loading ? (
                    <div className="flex items-center justify-center py-20">
                        <Loader2 className="h-6 w-6 animate-spin" style={{ color: "var(--amber-500)" }} />
                    </div>
                ) : (
                    <form onSubmit={handleSave} className="space-y-5">
                        {/* Employer Details */}
                        <Card className="animate-slide-up">
                            <CardContent className="p-5 space-y-4">
                                <div className="flex items-center gap-2 mb-1">
                                    <Building2 className="h-4 w-4" style={{ color: "var(--amber-500)" }} />
                                    <h2 className="text-sm font-bold" style={{ color: "var(--text-primary)" }}>
                                        Employer Details
                                    </h2>
                                </div>
                                <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                                    These details appear on employment contracts and uFiling CSV exports.
                                </p>

                                <div className="space-y-2">
                                    <Label htmlFor="employer-name">Employer Full Name</Label>
                                    <Input
                                        id="employer-name"
                                        placeholder="e.g. John & Sarah Smith"
                                        value={form.employerName}
                                        onChange={(e) => setForm({ ...form, employerName: e.target.value })}
                                    />
                                </div>

                                <div className="space-y-2">
                                    <Label htmlFor="employer-address">Address</Label>
                                    <Input
                                        id="employer-address"
                                        placeholder="e.g. 12 Protea Street, Sandton, 2196"
                                        value={form.employerAddress}
                                        onChange={(e) => setForm({ ...form, employerAddress: e.target.value })}
                                    />
                                </div>

                                <div className="space-y-2">
                                    <Label htmlFor="employer-id">Employer ID Number</Label>
                                    <Input
                                        id="employer-id"
                                        placeholder="SA ID or Passport Number"
                                        value={form.employerIdNumber}
                                        onChange={(e) => setForm({ ...form, employerIdNumber: e.target.value })}
                                    />
                                </div>
                            </CardContent>
                        </Card>

                        {/* UIF / Tax References */}
                        <Card className="animate-slide-up">
                            <CardContent className="p-5 space-y-4">
                                <h2 className="text-sm font-bold" style={{ color: "var(--text-primary)" }}>
                                    UIF & Tax References
                                </h2>
                                <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                                    Optional. Used in the uFiling CSV export and on payslip PDFs.
                                </p>

                                <div className="space-y-2">
                                    <Label htmlFor="uif-ref">uFiling Reference Number</Label>
                                    <Input
                                        id="uif-ref"
                                        placeholder="e.g. U123456789"
                                        value={form.uifRefNumber}
                                        onChange={(e) => setForm({ ...form, uifRefNumber: e.target.value })}
                                    />
                                    <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                                        Find this on your uFiling account or UIF registration letter.
                                    </p>
                                </div>

                                <div className="space-y-2">
                                    <Label htmlFor="sdl-number">SDL Number (optional)</Label>
                                    <Input
                                        id="sdl-number"
                                        placeholder="e.g. L123456789"
                                        value={form.sdlNumber}
                                        onChange={(e) => setForm({ ...form, sdlNumber: e.target.value })}
                                    />
                                </div>
                            </CardContent>
                        </Card>

                        {/* Save */}
                        <Button
                            type="submit"
                            className="w-full gap-2 h-12 text-base"
                            disabled={saving}
                        >
                            {saving ? (
                                <><Loader2 className="h-5 w-5 animate-spin" /> Saving…</>
                            ) : saved ? (
                                <><CheckCircle2 className="h-5 w-5" /> Saved!</>
                            ) : (
                                <><Save className="h-5 w-5" /> Save Settings</>
                            )}
                        </Button>

                        <p className="text-xs text-center" style={{ color: "var(--text-muted)" }}>
                            All data is stored on your device only. Nothing is sent to any server.
                        </p>
                    </form>
                )}
            </main>
        </div>
    );
}
</file>

<file path="app/ufiling/page.tsx">
"use client";

import * as React from "react";
import Link from "next/link";
import {
    ArrowLeft, Download, Loader2, CalendarDays, FileSpreadsheet, AlertCircle,
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Label } from "@/components/ui/label";
import { SideDrawer } from "@/components/layout/side-drawer";
import { getEmployees, getAllPayslips, getSettings } from "@/lib/storage";
import { Employee, PayslipInput, EmployerSettings } from "@/lib/schema";
import { generateUFilingData, rowsToCsv, downloadCsv, UFilingRow } from "@/lib/ufiling";

const MONTHS = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December",
];

export default function UFilingPage() {
    const now = new Date();
    const [loading, setLoading] = React.useState(true);
    const [month, setMonth] = React.useState(now.getMonth());
    const [year, setYear] = React.useState(now.getFullYear());
    const [employees, setEmployees] = React.useState<Employee[]>([]);
    const [payslips, setPayslips] = React.useState<PayslipInput[]>([]);
    const [settings, setSettings] = React.useState<EmployerSettings | null>(null);
    const [rows, setRows] = React.useState<UFilingRow[]>([]);

    React.useEffect(() => {
        async function load() {
            const [emps, pss, s] = await Promise.all([
                getEmployees(),
                getAllPayslips(),
                getSettings(),
            ]);
            setEmployees(emps);
            setPayslips(pss);
            setSettings(s);
            setLoading(false);
        }
        load();
    }, []);

    // Recalculate rows when month/year/data changes
    React.useEffect(() => {
        if (employees.length > 0 && payslips.length > 0) {
            const data = generateUFilingData(employees, payslips, month, year);
            setRows(data);
        } else {
            setRows([]);
        }
    }, [employees, payslips, month, year]);

    const handleDownload = () => {
        if (!settings) return;
        const csv = rowsToCsv(rows, settings);
        downloadCsv(csv, `uFiling_${MONTHS[month]}_${year}.csv`);
    };

    return (
        <div className="min-h-screen flex flex-col" style={{ backgroundColor: "var(--bg-base)" }}>
            <header
                className="sticky top-0 z-30 px-4 py-3"
                style={{
                    backgroundColor: "var(--bg-surface)",
                    borderBottom: "1px solid var(--border-subtle)",
                    boxShadow: "var(--shadow-sm)",
                }}
            >
                <div className="max-w-2xl mx-auto flex items-center gap-3">
                    <SideDrawer />
                    <Link href="/dashboard">
                        <button
                            aria-label="Back"
                            className="h-9 w-9 flex items-center justify-center rounded-xl transition-colors hover:bg-[var(--bg-subtle)]"
                            style={{ color: "var(--text-secondary)" }}
                        >
                            <ArrowLeft className="h-4 w-4" />
                        </button>
                    </Link>
                    <h1 className="font-bold text-base tracking-tight" style={{ color: "var(--text-primary)" }}>
                        uFiling Export
                    </h1>
                </div>
            </header>

            <main className="flex-1 max-w-2xl mx-auto w-full px-4 py-6 space-y-5">
                {loading ? (
                    <div className="flex items-center justify-center py-20">
                        <Loader2 className="h-6 w-6 animate-spin" style={{ color: "var(--amber-500)" }} />
                    </div>
                ) : (
                    <>
                        {/* Info banner */}
                        <Card className="animate-slide-up">
                            <CardContent className="p-4 flex items-start gap-3">
                                <FileSpreadsheet className="h-5 w-5 mt-0.5 shrink-0" style={{ color: "var(--amber-500)" }} />
                                <div>
                                    <p className="text-sm font-semibold" style={{ color: "var(--text-primary)" }}>
                                        UIF Declaration CSV
                                    </p>
                                    <p className="text-xs mt-1" style={{ color: "var(--text-muted)" }}>
                                        Download a CSV file formatted for the Department of Labour&apos;s uFiling system.
                                        Select a month and year, then export.
                                    </p>
                                </div>
                            </CardContent>
                        </Card>

                        {/* Settings warning */}
                        {settings && !settings.employerName && (
                            <Card className="animate-slide-up" style={{ borderColor: "var(--amber-500)" }}>
                                <CardContent className="p-4 flex items-start gap-3">
                                    <AlertCircle className="h-5 w-5 mt-0.5 shrink-0" style={{ color: "var(--amber-500)" }} />
                                    <div>
                                        <p className="text-sm font-semibold" style={{ color: "var(--text-primary)" }}>
                                            Employer details not set
                                        </p>
                                        <p className="text-xs mt-1" style={{ color: "var(--text-muted)" }}>
                                            The CSV will include your employer name and UIF reference number.{" "}
                                            <Link href="/settings" className="underline" style={{ color: "var(--amber-500)" }}>
                                                Set them in Settings
                                            </Link>.
                                        </p>
                                    </div>
                                </CardContent>
                            </Card>
                        )}

                        {/* Month/Year Picker */}
                        <Card className="animate-slide-up">
                            <CardContent className="p-5 space-y-4">
                                <div className="flex items-center gap-2 mb-2">
                                    <CalendarDays className="h-4 w-4" style={{ color: "var(--amber-500)" }} />
                                    <Label className="font-bold text-sm">Select Period</Label>
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    <div>
                                        <Label htmlFor="ufiling-month" className="text-xs">Month</Label>
                                        <select
                                            id="ufiling-month"
                                            value={month}
                                            onChange={(e) => setMonth(parseInt(e.target.value))}
                                            className="w-full mt-1 rounded-lg px-3 py-2.5 text-sm font-medium transition-colors"
                                            style={{
                                                backgroundColor: "var(--bg-subtle)",
                                                color: "var(--text-primary)",
                                                border: "1px solid var(--border-subtle)",
                                            }}
                                        >
                                            {MONTHS.map((m, i) => (
                                                <option key={i} value={i}>{m}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <Label htmlFor="ufiling-year" className="text-xs">Year</Label>
                                        <select
                                            id="ufiling-year"
                                            value={year}
                                            onChange={(e) => setYear(parseInt(e.target.value))}
                                            className="w-full mt-1 rounded-lg px-3 py-2.5 text-sm font-medium transition-colors"
                                            style={{
                                                backgroundColor: "var(--bg-subtle)",
                                                color: "var(--text-primary)",
                                                border: "1px solid var(--border-subtle)",
                                            }}
                                        >
                                            {[year - 1, year, year + 1].map((y) => (
                                                <option key={y} value={y}>{y}</option>
                                            ))}
                                        </select>
                                    </div>
                                </div>
                            </CardContent>
                        </Card>

                        {/* Preview Table */}
                        <Card className="animate-slide-up">
                            <CardContent className="p-0">
                                <div className="px-5 py-3" style={{ borderBottom: "1px solid var(--border-subtle)" }}>
                                    <h3 className="text-sm font-bold" style={{ color: "var(--text-primary)" }}>
                                        Preview ({rows.length} record{rows.length !== 1 ? "s" : ""})
                                    </h3>
                                </div>

                                {rows.length === 0 ? (
                                    <div className="p-8 text-center">
                                        <p className="text-sm" style={{ color: "var(--text-muted)" }}>
                                            No payslips found for {MONTHS[month]} {year}.
                                        </p>
                                    </div>
                                ) : (
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-xs">
                                            <thead>
                                                <tr style={{ borderBottom: "1px solid var(--border-subtle)" }}>
                                                    <th className="px-4 py-2.5 text-left font-semibold" style={{ color: "var(--text-muted)" }}>Employee</th>
                                                    <th className="px-4 py-2.5 text-right font-semibold" style={{ color: "var(--text-muted)" }}>Gross</th>
                                                    <th className="px-4 py-2.5 text-right font-semibold" style={{ color: "var(--text-muted)" }}>UIF (Emp)</th>
                                                    <th className="px-4 py-2.5 text-right font-semibold" style={{ color: "var(--text-muted)" }}>UIF (Er)</th>
                                                    <th className="px-4 py-2.5 text-right font-semibold" style={{ color: "var(--text-muted)" }}>Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {rows.map((r, i) => (
                                                    <tr key={i} style={{ borderBottom: "1px solid var(--border-subtle)" }}>
                                                        <td className="px-4 py-2.5 font-medium" style={{ color: "var(--text-primary)" }}>{r.employeeName}</td>
                                                        <td className="px-4 py-2.5 text-right tabular-nums" style={{ color: "var(--text-secondary)" }}>R {r.grossRemuneration.toFixed(2)}</td>
                                                        <td className="px-4 py-2.5 text-right tabular-nums" style={{ color: "var(--text-secondary)" }}>R {r.uifEmployee.toFixed(2)}</td>
                                                        <td className="px-4 py-2.5 text-right tabular-nums" style={{ color: "var(--text-secondary)" }}>R {r.uifEmployer.toFixed(2)}</td>
                                                        <td className="px-4 py-2.5 text-right tabular-nums font-semibold" style={{ color: "var(--amber-500)" }}>R {r.totalUif.toFixed(2)}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </CardContent>
                        </Card>

                        {/* Download */}
                        <Button
                            className="w-full gap-2 h-12 text-base"
                            onClick={handleDownload}
                            disabled={rows.length === 0}
                        >
                            <Download className="h-5 w-5" />
                            Download CSV for uFiling
                        </Button>
                    </>
                )}
            </main>
        </div>
    );
}
</file>

<file path="app/wizard/page.tsx">
"use client";

import * as React from "react";
import Link from "next/link";
import { useRouter, useSearchParams } from "next/navigation";
import { ArrowLeft, ArrowRight, Loader2, Check } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardFooter, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { Stepper } from "@/components/ui/stepper";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { SideDrawer } from "@/components/layout/side-drawer";
import { getEmployees, savePayslip } from "@/lib/storage";
import { Employee, PayslipInput } from "@/lib/schema";
import { calculatePayslip, NMW_RATE } from "@/lib/calculator";

const STEPS = [
    { label: "Hours", description: "Ordinary & overtime" },
    { label: "Sundays & Holidays", description: "Special rates" },
    { label: "Deductions", description: "UIF & accommodation" },
    { label: "Review", description: "Final confirmation" },
];

const safeDate = (s: string): Date => {
    const d = new Date(s);
    return isNaN(d.getTime()) ? new Date() : d;
};

function WizardContent() {
    const router = useRouter();
    const searchParams = useSearchParams();
    const empId = searchParams?.get("empId");

    const [employee, setEmployee] = React.useState<Employee | null>(null);
    const [loadingInitial, setLoadingInitial] = React.useState(true);
    const [currentStep, setCurrentStep] = React.useState(0);
    const [loading, setLoading] = React.useState(false);

    const now = new Date();
    const defaultStart = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split("T")[0];
    const defaultEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0).toISOString().split("T")[0];

    const [hours, setHours] = React.useState({ ordinary: "", overtime: "", sunday: "", holiday: "" });
    const [dates, setDates] = React.useState({ start: defaultStart, end: defaultEnd });
    const [periodError, setPeriodError] = React.useState("");
    const [includeAccommodation, setIncludeAccommodation] = React.useState(false);

    React.useEffect(() => {
        async function load() {
            if (!empId) { router.push("/employees"); return; }
            const employees = await getEmployees();
            const emp = employees.find((e) => e.id === empId);
            if (emp) { setEmployee(emp); } else { router.push("/employees"); }
            setLoadingInitial(false);
        }
        load();
    }, [empId, router]);

    const totalHours =
        (Number(hours.ordinary) || 0) +
        (Number(hours.overtime) || 0) +
        (Number(hours.sunday) || 0) +
        (Number(hours.holiday) || 0);

    const breakdown = employee
        ? calculatePayslip({
            id: "preview",
            employeeId: employee.id,
            payPeriodStart: safeDate(dates.start),
            payPeriodEnd: safeDate(dates.end),
            ordinaryHours: Number(hours.ordinary) || 0,
            overtimeHours: Number(hours.overtime) || 0,
            sundayHours: Number(hours.sunday) || 0,
            publicHolidayHours: Number(hours.holiday) || 0,
            hourlyRate: employee.hourlyRate,
            includeAccommodation,
            otherDeductions: 0,
            createdAt: new Date(),
        })
        : null;

    const handleNext = async () => {
        if (currentStep === 0) {
            if (!dates.start || !dates.end) { setPeriodError("Please select the pay period."); return; }
            if (!hours.ordinary && !hours.overtime && !hours.sunday && !hours.holiday) {
                setPeriodError("Please enter at least some hours worked.");
                return;
            }
            setPeriodError("");
        }

        if (currentStep < STEPS.length - 1) {
            setCurrentStep((s) => s + 1);
            return;
        }

        // Save & navigate to preview
        if (!employee) return;
        setLoading(true);

        const payslipInput: PayslipInput = {
            id: crypto.randomUUID(),
            employeeId: employee.id,
            payPeriodStart: safeDate(dates.start),
            payPeriodEnd: safeDate(dates.end),
            ordinaryHours: Number(hours.ordinary) || 0,
            overtimeHours: Number(hours.overtime) || 0,
            sundayHours: Number(hours.sunday) || 0,
            publicHolidayHours: Number(hours.holiday) || 0,
            hourlyRate: employee.hourlyRate,
            includeAccommodation,
            otherDeductions: 0,
            createdAt: new Date(),
        };

        try {
            await savePayslip(payslipInput);
            router.push(`/preview?payslipId=${payslipInput.id}&empId=${employee.id}`);
        } catch (err) {
            console.error(err);
            setLoading(false);
        }
    };

    if (loadingInitial) {
        return (
            <div className="min-h-screen flex items-center justify-center" style={{ backgroundColor: "var(--bg-base)" }}>
                <Loader2 className="h-8 w-8 animate-spin" style={{ color: "var(--amber-500)" }} />
            </div>
        );
    }

    if (!employee) return null;

    return (
        <div className="min-h-screen flex flex-col" style={{ backgroundColor: "var(--bg-base)" }}>
            {/* Header */}
            <header
                className="sticky top-0 z-30 px-4 py-3"
                style={{
                    backgroundColor: "var(--bg-surface)",
                    borderBottom: "1px solid var(--border-subtle)",
                    boxShadow: "var(--shadow-sm)",
                }}
            >
                <div className="max-w-xl mx-auto flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <SideDrawer />
                        <Link href="/employees">
                            <button
                                aria-label="Back"
                                className="h-9 w-9 flex items-center justify-center rounded-xl transition-colors hover:bg-[var(--bg-subtle)]"
                                style={{ color: "var(--text-secondary)" }}
                            >
                                <ArrowLeft className="h-4 w-4" />
                            </button>
                        </Link>
                        <div>
                            <h1 className="font-bold text-sm tracking-tight leading-tight" style={{ color: "var(--text-primary)" }}>
                                Payslip Wizard
                            </h1>
                            <p className="text-xs leading-tight" style={{ color: "var(--text-muted)" }}>
                                {employee.name}
                            </p>
                        </div>
                    </div>
                    <span
                        className="text-xs font-semibold px-3 py-1 rounded-full"
                        style={{
                            backgroundColor: "rgba(196,122,28,0.10)",
                            color: "var(--amber-500)",
                        }}
                    >
                        Step {currentStep + 1}/{STEPS.length}
                    </span>
                </div>
            </header>

            <main className="flex-1 max-w-xl mx-auto w-full px-4 py-6 space-y-5">
                {/* Stepper */}
                <div
                    className="p-5 rounded-2xl"
                    style={{
                        backgroundColor: "var(--bg-surface)",
                        border: "1px solid var(--border-subtle)",
                        boxShadow: "var(--shadow-sm)",
                    }}
                >
                    <Stepper steps={STEPS} currentStep={currentStep} />
                </div>

                {/* NMW notice */}
                {employee.hourlyRate <= NMW_RATE && (
                    <Alert variant="warning">
                        <AlertDescription>
                            Using National Minimum Wage (R{NMW_RATE}/hr).
                        </AlertDescription>
                    </Alert>
                )}

                {/* Step Card */}
                <Card key={currentStep} className="animate-slide-right">
                    <CardHeader>
                        <CardTitle>{STEPS[currentStep].label}</CardTitle>
                        <CardDescription>{STEPS[currentStep].description}</CardDescription>
                    </CardHeader>

                    <CardContent className="space-y-5">
                        {/* STEP 0 — Hours & Period */}
                        {currentStep === 0 && (
                            <div className="space-y-5">
                                <div className="grid grid-cols-2 gap-3">
                                    <div className="space-y-2">
                                        <Label htmlFor="start">Period Start</Label>
                                        <Input
                                            id="start"
                                            type="date"
                                            value={dates.start}
                                            onChange={(e) => setDates({ ...dates, start: e.target.value })}
                                            error={periodError || undefined}
                                        />
                                    </div>
                                    <div className="space-y-2">
                                        <Label htmlFor="end">Period End</Label>
                                        <Input
                                            id="end"
                                            type="date"
                                            value={dates.end}
                                            onChange={(e) => setDates({ ...dates, end: e.target.value })}
                                        />
                                    </div>
                                </div>

                                <div
                                    className="pt-4 space-y-4"
                                    style={{ borderTop: "1px solid var(--border-subtle)" }}
                                >
                                    <div className="space-y-2">
                                        <Label htmlFor="ordinary">Ordinary Hours Worked</Label>
                                        <Input
                                            id="ordinary"
                                            type="number"
                                            min="0"
                                            placeholder="e.g. 160"
                                            value={hours.ordinary}
                                            onChange={(e) => setHours({ ...hours, ordinary: e.target.value })}
                                        />
                                        <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                                            40hrs/week = ±160 hrs/month
                                        </p>
                                    </div>
                                    <div className="space-y-2">
                                        <Label htmlFor="overtime">Overtime Hours (1.5× rate)</Label>
                                        <Input
                                            id="overtime"
                                            type="number"
                                            min="0"
                                            placeholder="0"
                                            value={hours.overtime}
                                            onChange={(e) => setHours({ ...hours, overtime: e.target.value })}
                                        />
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* STEP 1 — Sundays & Holidays */}
                        {currentStep === 1 && (
                            <div className="space-y-4">
                                <Alert variant="default">
                                    <AlertDescription>
                                        Sundays and Public Holidays are legally paid at{" "}
                                        <strong>2× the normal rate</strong> (BCEA).
                                    </AlertDescription>
                                </Alert>
                                <div className="space-y-2">
                                    <Label htmlFor="sunday">Sunday Hours (2× rate)</Label>
                                    <Input
                                        id="sunday"
                                        type="number"
                                        min="0"
                                        placeholder="0"
                                        value={hours.sunday}
                                        onChange={(e) => setHours({ ...hours, sunday: e.target.value })}
                                    />
                                </div>
                                <div className="space-y-2">
                                    <Label htmlFor="holiday">Public Holiday Hours (2× rate)</Label>
                                    <Input
                                        id="holiday"
                                        type="number"
                                        min="0"
                                        placeholder="0"
                                        value={hours.holiday}
                                        onChange={(e) => setHours({ ...hours, holiday: e.target.value })}
                                    />
                                </div>
                            </div>
                        )}

                        {/* STEP 2 — Deductions */}
                        {currentStep === 2 && (
                            <div className="space-y-4">
                                <Alert variant={totalHours > 24 ? "success" : "warning"}>
                                    <AlertDescription>
                                        <strong>UIF</strong> (1% employee + 1% employer) is{" "}
                                        <strong>{totalHours > 24 ? "applicable" : "NOT applicable"}</strong>{" "}
                                        — worker has {totalHours > 24 ? "more than" : "24 or fewer"} hours this period.
                                    </AlertDescription>
                                </Alert>

                                <button
                                    type="button"
                                    onClick={() => setIncludeAccommodation((v) => !v)}
                                    className="w-full flex items-start gap-3 p-4 rounded-xl text-left transition-all duration-200 active:scale-[0.99] hover:bg-[var(--bg-subtle)]"
                                    style={{
                                        border: `1.5px solid ${includeAccommodation ? "var(--amber-500)" : "var(--border-default)"}`,
                                        backgroundColor: includeAccommodation ? "rgba(196,122,28,0.04)" : "transparent",
                                    }}
                                >
                                    <div
                                        className="h-6 w-6 rounded flex items-center justify-center flex-shrink-0 mt-0.5 transition-all duration-200"
                                        style={{
                                            backgroundColor: includeAccommodation ? "var(--amber-500)" : "transparent",
                                            border: `1.5px solid ${includeAccommodation ? "var(--amber-500)" : "var(--border-strong)"}`,
                                        }}
                                    >
                                        {includeAccommodation && <Check className="h-3.5 w-3.5 text-white" strokeWidth={2.5} />}
                                    </div>
                                    <div>
                                        <p className="font-semibold text-sm" style={{ color: "var(--text-primary)" }}>
                                            Accommodation Deduction (10%)
                                        </p>
                                        <p className="text-xs mt-0.5" style={{ color: "var(--text-secondary)" }}>
                                            Deduct up to 10% of gross wage for accommodation provided (SD7 — legal maximum).
                                        </p>
                                    </div>
                                </button>
                            </div>
                        )}

                        {/* STEP 3 — Review */}
                        {currentStep === 3 && breakdown && (
                            <div className="space-y-4 animate-fade-in">
                                {/* Earnings rows */}
                                <div
                                    className="rounded-xl overflow-hidden"
                                    style={{ border: "1px solid var(--border-subtle)" }}
                                >
                                    <div
                                        className="px-4 py-2.5 flex justify-between items-center text-xs font-bold uppercase tracking-widest"
                                        style={{
                                            backgroundColor: "var(--bg-subtle)",
                                            borderBottom: "1px solid var(--border-subtle)",
                                            color: "var(--text-muted)",
                                        }}
                                    >
                                        <span>Payslip Summary</span>
                                        <span>R{employee.hourlyRate.toFixed(2)}/hr</span>
                                    </div>

                                    {/* Earnings */}
                                    <div className="px-4 pt-4 pb-2 space-y-2">
                                        <p className="text-xs font-bold uppercase tracking-wider" style={{ color: "var(--amber-500)" }}>Earnings</p>
                                        <Row label={`Ordinary (${Number(hours.ordinary) || 0}h)`} value={`R ${breakdown.ordinaryPay.toFixed(2)}`} />
                                        {(Number(hours.overtime) || 0) > 0 && <Row label={`Overtime (${Number(hours.overtime)}h)`} value={`R ${breakdown.overtimePay.toFixed(2)}`} />}
                                        {(Number(hours.sunday) || 0) > 0 && <Row label={`Sunday (${Number(hours.sunday)}h)`} value={`R ${breakdown.sundayPay.toFixed(2)}`} />}
                                        {(Number(hours.holiday) || 0) > 0 && <Row label={`Public Holiday (${Number(hours.holiday)}h)`} value={`R ${breakdown.publicHolidayPay.toFixed(2)}`} />}
                                        <Row label="Gross Pay" value={`R ${breakdown.grossPay.toFixed(2)}`} bold />
                                    </div>

                                    <div style={{ borderTop: "1px solid var(--border-subtle)" }} />

                                    {/* Deductions */}
                                    <div className="px-4 pt-3 pb-2 space-y-2">
                                        <p className="text-xs font-bold uppercase tracking-wider" style={{ color: "var(--amber-500)" }}>Deductions</p>
                                        <Row label={`UIF ${totalHours > 24 ? "(1%)" : "(n/a)"}`} value={`-R ${breakdown.deductions.uifEmployee.toFixed(2)}`} red />
                                        {includeAccommodation && breakdown.deductions.accommodation && (
                                            <Row label="Accommodation (10%)" value={`-R ${breakdown.deductions.accommodation.toFixed(2)}`} red />
                                        )}
                                        <Row label="Total Deductions" value={`R ${breakdown.deductions.total.toFixed(2)}`} bold />
                                    </div>

                                    {/* Net Pay bar */}
                                    <div
                                        className="flex justify-between items-center px-5 py-5"
                                        style={{ backgroundColor: "var(--amber-500)" }}
                                    >
                                        <span className="font-bold text-lg text-white">Net Pay</span>
                                        <span className="font-extrabold text-2xl text-white tabular-nums">
                                            R {breakdown.netPay.toFixed(2)}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        )}
                    </CardContent>

                    <CardFooter className="flex justify-between gap-3">
                        <Button
                            size="lg"
                            variant="outline"
                            onClick={() => setCurrentStep((s) => Math.max(0, s - 1))}
                            disabled={currentStep === 0 || loading}
                        >
                            Back
                        </Button>
                        <Button
                            size="lg"
                            onClick={handleNext}
                            disabled={loading}
                            className="flex-1 sm:flex-none sm:min-w-[160px]"
                        >
                            {loading ? (
                                <><Loader2 className="h-4 w-4 animate-spin" /> Saving…</>
                            ) : currentStep === STEPS.length - 1 ? (
                                "Save & Preview"
                            ) : (
                                <>Next <ArrowRight className="h-4 w-4" /></>
                            )}
                        </Button>
                    </CardFooter>
                </Card>
            </main>
        </div>
    );
}

function Row({
    label,
    value,
    bold,
    red,
}: {
    label: string;
    value: string;
    bold?: boolean;
    red?: boolean;
}) {
    return (
        <div className="flex justify-between items-center text-sm">
            <span style={{ color: bold ? "var(--text-primary)" : "var(--text-secondary)", fontWeight: bold ? 600 : 400 }}>
                {label}
            </span>
            <span
                className="tabular-nums"
                style={{
                    color: red ? "var(--red-500)" : bold ? "var(--text-primary)" : "var(--text-secondary)",
                    fontWeight: bold ? 700 : 400,
                }}
            >
                {value}
            </span>
        </div>
    );
}

export default function WizardPage() {
    return (
        <React.Suspense
            fallback={
                <div className="min-h-screen flex items-center justify-center" style={{ backgroundColor: "var(--bg-base)" }}>
                    <Loader2 className="h-8 w-8 animate-spin" style={{ color: "var(--amber-500)" }} />
                </div>
            }
        >
            <WizardContent />
        </React.Suspense>
    );
}
</file>

<file path="components/layout/side-drawer.tsx">
"use client";

import * as React from "react";
import Link from "next/link";
import {
    X,
    Sun,
    Moon,
    Monitor,
    FileText,
    Users,
    Home,
    ChevronRight,
    Menu,
    LayoutDashboard,
    Palmtree,
    FileSpreadsheet,
    Settings,
} from "lucide-react";
import { useTheme } from "@/components/theme-provider";

const NAV_LINKS = [
    { href: "/", label: "Home", icon: Home },
    { href: "/dashboard", label: "Dashboard", icon: LayoutDashboard },
    { href: "/employees", label: "Employees", icon: Users },
    { href: "/leave", label: "Leave Tracker", icon: Palmtree, note: "Select an employee first" },
    { href: "/contracts", label: "Contracts", icon: FileText },
    { href: "/ufiling", label: "uFiling Export", icon: FileSpreadsheet },
    { href: "/settings", label: "Settings", icon: Settings },
];

const THEME_OPTIONS = [
    { value: "system" as const, label: "Auto", icon: Monitor },
    { value: "light" as const, label: "Light", icon: Sun },
    { value: "dark" as const, label: "Dark", icon: Moon },
];

export function SideDrawer() {
    const [open, setOpen] = React.useState(false);
    const { theme, setTheme } = useTheme();

    // Close on Escape
    React.useEffect(() => {
        const handler = (e: KeyboardEvent) => {
            if (e.key === "Escape") setOpen(false);
        };
        document.addEventListener("keydown", handler);
        return () => document.removeEventListener("keydown", handler);
    }, []);

    // Prevent body scroll when open
    React.useEffect(() => {
        if (open) {
            document.body.style.overflow = "hidden";
        } else {
            document.body.style.overflow = "";
        }
        return () => { document.body.style.overflow = ""; };
    }, [open]);

    return (
        <>
            {/* Hamburger Button */}
            <button
                onClick={() => setOpen(true)}
                aria-label="Open menu"
                className="h-10 w-10 flex items-center justify-center rounded-xl transition-all duration-200 hover:bg-[var(--bg-subtle)] active:scale-95 text-[var(--text-secondary)]"
            >
                <Menu className="h-5 w-5" />
            </button>

            {/* Backdrop */}
            {open && (
                <div
                    className="fixed inset-0 z-40 bg-black/40 backdrop-blur-sm animate-fade-in"
                    onClick={() => setOpen(false)}
                />
            )}

            {/* Drawer Panel */}
            <div
                className={[
                    "fixed top-0 left-0 h-full w-72 z-50 flex flex-col",
                    "shadow-[var(--shadow-xl)] transition-transform duration-300",
                    open ? "translate-x-0 animate-drawer-in" : "-translate-x-full",
                ].join(" ")}
                style={{ backgroundColor: "var(--bg-surface)", borderRight: "1px solid var(--border-subtle)" }}
                aria-modal="true"
                role="dialog"
            >
                {/* Header */}
                <div className="flex items-center justify-between px-5 pt-5 pb-4" style={{ borderBottom: "1px solid var(--border-subtle)" }}>
                    <div>
                        <p className="text-xs font-semibold tracking-widest uppercase" style={{ color: "var(--amber-500)" }}>
                            LekkerLedger
                        </p>
                        <p className="text-xs mt-0.5" style={{ color: "var(--text-muted)" }}>
                            By Nightshift Labs ZA
                        </p>
                    </div>
                    <button
                        onClick={() => setOpen(false)}
                        aria-label="Close menu"
                        className="h-8 w-8 flex items-center justify-center rounded-lg transition-all hover:bg-[var(--bg-subtle)] active:scale-95"
                        style={{ color: "var(--text-muted)" }}
                    >
                        <X className="h-4 w-4" />
                    </button>
                </div>

                {/* Navigation */}
                <nav className="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
                    <p className="text-xs font-semibold uppercase tracking-widest px-2 mb-2" style={{ color: "var(--text-muted)" }}>
                        Navigation
                    </p>
                    {NAV_LINKS.map(({ href, label, icon: Icon }) => (
                        <Link
                            key={href}
                            href={href}
                            onClick={() => setOpen(false)}
                            className="flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-150 group"
                            style={{ color: "var(--text-primary)" }}
                        >
                            <span
                                className="h-8 w-8 flex items-center justify-center rounded-lg transition-colors"
                                style={{ backgroundColor: "var(--bg-subtle)", color: "var(--amber-500)" }}
                            >
                                <Icon className="h-4 w-4" />
                            </span>
                            <span className="flex-1">{label}</span>
                            <ChevronRight className="h-3.5 w-3.5 opacity-0 group-hover:opacity-100 transition-opacity" style={{ color: "var(--text-muted)" }} />
                        </Link>
                    ))}
                </nav>

                {/* Theme Switcher */}
                <div className="px-4 py-4" style={{ borderTop: "1px solid var(--border-subtle)" }}>
                    <p className="text-xs font-semibold uppercase tracking-widest mb-3" style={{ color: "var(--text-muted)" }}>
                        Appearance
                    </p>
                    <div
                        className="flex items-center rounded-lg p-1 gap-1"
                        style={{ backgroundColor: "var(--bg-subtle)" }}
                    >
                        {THEME_OPTIONS.map(({ value, label, icon: Icon }) => {
                            const active = theme === value;
                            return (
                                <button
                                    key={value}
                                    onClick={() => setTheme(value)}
                                    className="flex-1 flex flex-col items-center gap-1 py-2 px-1 rounded-md text-xs font-medium transition-all duration-200 active:scale-95"
                                    style={{
                                        backgroundColor: active ? "var(--bg-surface)" : "transparent",
                                        color: active ? "var(--amber-500)" : "var(--text-muted)",
                                        boxShadow: active ? "var(--shadow-sm)" : "none",
                                    }}
                                >
                                    <Icon className="h-4 w-4" />
                                    {label}
                                </button>
                            );
                        })}
                    </div>
                </div>

                {/* Footer */}
                <div className="px-5 pb-6 pt-3" style={{ borderTop: "1px solid var(--border-subtle)" }}>
                    <div className="flex items-center gap-2">
                        <div
                            className="h-7 w-7 rounded-full flex items-center justify-center text-xs font-black"
                            style={{ backgroundColor: "var(--amber-500)", color: "var(--text-inverse)" }}
                        >
                            N
                        </div>
                        <div>
                            <p className="text-xs font-semibold" style={{ color: "var(--text-primary)" }}>
                                Nightshift Labs ZA
                            </p>
                            <p className="text-xs" style={{ color: "var(--text-muted)" }}>
                                Crafted in South Africa 🇿🇦
                            </p>
                        </div>
                    </div>
                    <p className="text-xs mt-3" style={{ color: "var(--text-muted)" }}>
                        Beta v0.2 · Data saved on your device only. No accounts, no servers.
                    </p>
                </div>
            </div>
        </>
    );
}
</file>

<file path="components/theme-provider.tsx">
"use client";

import * as React from "react";

type Theme = "light" | "dark" | "system";

interface ThemeContextValue {
    theme: Theme;
    resolvedTheme: "light" | "dark";
    setTheme: (t: Theme) => void;
}

const ThemeContext = React.createContext<ThemeContextValue>({
    theme: "system",
    resolvedTheme: "light",
    setTheme: () => { },
});

export function useTheme() {
    return React.useContext(ThemeContext);
}

export function ThemeProvider({ children }: { children: React.ReactNode }) {
    const [theme, setThemeState] = React.useState<Theme>("system");
    const [resolvedTheme, setResolvedTheme] = React.useState<"light" | "dark">("light");

    React.useEffect(() => {
        const stored = (localStorage.getItem("ll-theme") as Theme) ?? "system";
        setThemeState(stored);
    }, []);

    React.useEffect(() => {
        const apply = (t: Theme) => {
            const mq = window.matchMedia("(prefers-color-scheme: dark)");
            const resolved = t === "system" ? (mq.matches ? "dark" : "light") : t;
            document.documentElement.setAttribute("data-theme", resolved);
            setResolvedTheme(resolved);
        };

        apply(theme);

        if (theme === "system") {
            const mq = window.matchMedia("(prefers-color-scheme: dark)");
            const handler = () => apply("system");
            mq.addEventListener("change", handler);
            return () => mq.removeEventListener("change", handler);
        }
    }, [theme]);

    const setTheme = (t: Theme) => {
        localStorage.setItem("ll-theme", t);
        setThemeState(t);
    };

    return (
        <ThemeContext.Provider value={{ theme, resolvedTheme, setTheme }}>
            {children}
        </ThemeContext.Provider>
    );
}
</file>

<file path="components/ui/alert.tsx">
import * as React from "react"
import { AlertCircle, CheckCircle2, Info, XCircle } from "lucide-react"

export interface AlertProps extends React.HTMLAttributes<HTMLDivElement> {
    variant?: "default" | "success" | "warning" | "error";
}

const VARIANTS = {
    default: {
        bg: "rgba(196,122,28,0.08)",
        border: "rgba(196,122,28,0.25)",
        color: "var(--amber-500)",
        Icon: Info,
    },
    success: {
        bg: "rgba(26,107,58,0.08)",
        border: "rgba(26,107,58,0.25)",
        color: "var(--green-500)",
        Icon: CheckCircle2,
    },
    warning: {
        bg: "rgba(196,122,28,0.08)",
        border: "rgba(196,122,28,0.30)",
        color: "var(--amber-warn-500)",
        Icon: AlertCircle,
    },
    error: {
        bg: "rgba(192,57,43,0.08)",
        border: "rgba(192,57,43,0.25)",
        color: "var(--red-500)",
        Icon: XCircle,
    },
};

const Alert = React.forwardRef<HTMLDivElement, AlertProps>(
    ({ className, variant = "default", children, style, ...props }, ref) => {
        const v = VARIANTS[variant];
        return (
            <div
                ref={ref}
                role="alert"
                className={["relative flex w-full items-start gap-3 rounded-xl p-4 transition-all", className].filter(Boolean).join(" ")}
                style={{
                    backgroundColor: v.bg,
                    border: `1px solid ${v.border}`,
                    ...style,
                }}
                {...props}
            >
                <v.Icon className="h-5 w-5 mt-0.5 shrink-0" style={{ color: v.color }} />
                <div className="flex-1 space-y-0.5 min-w-0">{children}</div>
            </div>
        );
    }
);
Alert.displayName = "Alert";

const AlertTitle = React.forwardRef<HTMLHeadingElement, React.HTMLAttributes<HTMLHeadingElement>>(
    ({ className, style, ...props }, ref) => (
        <h5
            ref={ref}
            className={["text-sm font-semibold leading-tight", className].filter(Boolean).join(" ")}
            style={{ color: "var(--text-primary)", ...style }}
            {...props}
        />
    )
);
AlertTitle.displayName = "AlertTitle";

const AlertDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
    ({ className, style, ...props }, ref) => (
        <p
            ref={ref}
            className={["text-sm leading-relaxed", className].filter(Boolean).join(" ")}
            style={{ color: "var(--text-secondary)", ...style }}
            {...props}
        />
    )
);
AlertDescription.displayName = "AlertDescription";

export { Alert, AlertTitle, AlertDescription };
</file>

<file path="components/ui/button.tsx">
import * as React from "react"

export interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
    variant?: "default" | "outline" | "ghost" | "link" | "danger" | "secondary";
    size?: "default" | "sm" | "lg" | "icon";
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
    ({ className, variant = "default", size = "default", style, ...props }, ref) => {

        let variantStyle: React.CSSProperties = {};
        switch (variant) {
            case "default":
                variantStyle = {
                    backgroundColor: "var(--amber-500)",
                    color: "var(--text-inverse)",
                };
                break;
            case "secondary":
                variantStyle = {
                    backgroundColor: "var(--green-500)",
                    color: "#ffffff",
                };
                break;
            case "outline":
                variantStyle = {
                    border: "1.5px solid var(--border-default)",
                    backgroundColor: "transparent",
                    color: "var(--text-primary)",
                };
                break;
            case "ghost":
                variantStyle = {
                    backgroundColor: "transparent",
                    color: "var(--text-secondary)",
                };
                break;
            case "link":
                variantStyle = {
                    backgroundColor: "transparent",
                    color: "var(--amber-500)",
                    textDecoration: "underline",
                    textUnderlineOffset: "4px",
                };
                break;
            case "danger":
                variantStyle = {
                    backgroundColor: "var(--red-500)",
                    color: "#ffffff",
                };
                break;
        }

        let sizeClasses = "";
        switch (size) {
            case "default":
                sizeClasses = "h-10 px-5 py-2 text-sm";
                break;
            case "sm":
                sizeClasses = "h-8 px-3 py-1.5 text-xs";
                break;
            case "lg":
                sizeClasses = "h-12 px-7 py-3 text-base";
                break;
            case "icon":
                sizeClasses = "h-10 w-10";
                break;
        }

        const baseClasses = "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl font-semibold ring-offset-2 transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 active:scale-[0.97] select-none";

        const hoverMap: Record<string, string> = {
            default: "hover:opacity-90 hover:shadow-md",
            secondary: "hover:opacity-90 hover:shadow-md",
            outline: "hover:bg-[var(--bg-subtle)]",
            ghost: "hover:bg-[var(--bg-subtle)] hover:text-[var(--text-primary)]",
            link: "",
            danger: "hover:opacity-90",
        };

        const finalClassName = [baseClasses, sizeClasses, hoverMap[variant] ?? "", className]
            .filter(Boolean).join(" ");

        return (
            <button
                ref={ref}
                className={finalClassName}
                style={{ ...variantStyle, ...style }}
                {...props}
            />
        );
    }
);
Button.displayName = "Button";

export { Button };
</file>

<file path="components/ui/card.tsx">
import * as React from "react"

const Card = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
    ({ className, style, ...props }, ref) => (
        <div
            ref={ref}
            className={["rounded-2xl transition-all duration-200", className].filter(Boolean).join(" ")}
            style={{
                backgroundColor: "var(--bg-surface)",
                border: "1px solid var(--border-subtle)",
                boxShadow: "var(--shadow-md)",
                ...style,
            }}
            {...props}
        />
    )
);
Card.displayName = "Card";

const CardHeader = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
    ({ className, ...props }, ref) => (
        <div
            ref={ref}
            className={["flex flex-col space-y-1 p-6", className].filter(Boolean).join(" ")}
            {...props}
        />
    )
);
CardHeader.displayName = "CardHeader";

const CardTitle = React.forwardRef<HTMLHeadingElement, React.HTMLAttributes<HTMLHeadingElement>>(
    ({ className, style, ...props }, ref) => (
        <h3
            ref={ref}
            className={["text-xl font-bold tracking-tight leading-snug", className].filter(Boolean).join(" ")}
            style={{ color: "var(--text-primary)", ...style }}
            {...props}
        />
    )
);
CardTitle.displayName = "CardTitle";

const CardDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
    ({ className, style, ...props }, ref) => (
        <p
            ref={ref}
            className={["text-sm leading-relaxed", className].filter(Boolean).join(" ")}
            style={{ color: "var(--text-secondary)", ...style }}
            {...props}
        />
    )
);
CardDescription.displayName = "CardDescription";

const CardContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
    ({ className, ...props }, ref) => (
        <div ref={ref} className={["p-6 pt-0", className].filter(Boolean).join(" ")} {...props} />
    )
);
CardContent.displayName = "CardContent";

const CardFooter = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
    ({ className, style, ...props }, ref) => (
        <div
            ref={ref}
            className={["flex items-center p-4 rounded-b-2xl", className].filter(Boolean).join(" ")}
            style={{
                borderTop: "1px solid var(--border-subtle)",
                backgroundColor: "var(--bg-subtle)",
                ...style,
            }}
            {...props}
        />
    )
);
CardFooter.displayName = "CardFooter";

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent };
</file>

<file path="components/ui/input.tsx">
import * as React from "react"

export interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
    error?: string;
}

const Input = React.forwardRef<HTMLInputElement, InputProps>(
    ({ className, type, error, style, ...props }, ref) => {
        return (
            <div className="flex flex-col gap-1 w-full">
                <input
                    type={type}
                    ref={ref}
                    className={["w-full rounded-xl px-4 py-2.5 text-sm font-medium outline-none transition-all duration-200 placeholder:font-normal", className].filter(Boolean).join(" ")}
                    style={{
                        height: "44px",
                        backgroundColor: "var(--bg-surface)",
                        color: "var(--text-primary)",
                        border: `1.5px solid ${error ? "var(--red-500)" : "var(--border-default)"}`,
                        boxShadow: error ? "0 0 0 3px rgba(192,57,43,0.12)" : "none",
                        ...style,
                    }}
                    onFocus={(e) => {
                        (e.target as HTMLInputElement).style.borderColor = error ? "var(--red-500)" : "var(--amber-500)";
                        (e.target as HTMLInputElement).style.boxShadow = error
                            ? "0 0 0 3px rgba(192,57,43,0.15)"
                            : "0 0 0 3px rgba(196,122,28,0.15)";
                    }}
                    onBlur={(e) => {
                        (e.target as HTMLInputElement).style.borderColor = error ? "var(--red-500)" : "var(--border-default)";
                        (e.target as HTMLInputElement).style.boxShadow = error ? "0 0 0 3px rgba(192,57,43,0.12)" : "none";
                    }}
                    {...props}
                />
                {error && (
                    <span
                        className="text-xs font-medium animate-slide-down"
                        style={{ color: "var(--red-500)" }}
                    >
                        {error}
                    </span>
                )}
            </div>
        );
    }
);
Input.displayName = "Input";

export { Input };
</file>

<file path="components/ui/label.tsx">
import * as React from "react"

const Label = React.forwardRef<HTMLLabelElement, React.LabelHTMLAttributes<HTMLLabelElement>>(
    ({ className, style, ...props }, ref) => (
        <label
            ref={ref}
            className={["block text-sm font-semibold leading-none", className].filter(Boolean).join(" ")}
            style={{ color: "var(--text-primary)", ...style }}
            {...props}
        />
    )
);
Label.displayName = "Label";

export { Label };
</file>

<file path="components/ui/stepper.tsx">
import * as React from "react"
import { Check } from "lucide-react"

export interface StepperProps {
    steps: { label: string; description?: string }[];
    currentStep: number;
    className?: string;
}

export const Stepper = ({ steps, currentStep, className }: StepperProps) => {
    return (
        <div className={["flex w-full items-start", className].filter(Boolean).join(" ")}>
            {steps.map((step, index) => {
                const isCompleted = index < currentStep;
                const isCurrent = index === currentStep;
                const isLast = index === steps.length - 1;

                return (
                    <React.Fragment key={step.label}>
                        {/* Step column */}
                        <div className="flex flex-col items-center gap-2 flex-shrink-0" style={{ minWidth: 56 }}>
                            {/* Circle */}
                            <div
                                className="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300"
                                style={{
                                    background: isCompleted
                                        ? "var(--green-500)"
                                        : isCurrent
                                            ? "var(--amber-500)"
                                            : "var(--bg-subtle)",
                                    color: isCompleted || isCurrent ? "#ffffff" : "var(--text-muted)",
                                    border: isCurrent
                                        ? "2.5px solid var(--amber-500)"
                                        : isCompleted
                                            ? "2.5px solid var(--green-500)"
                                            : "2px solid var(--border-default)",
                                    boxShadow: isCurrent
                                        ? "0 0 0 4px rgba(196,122,28,0.18)"
                                        : isCompleted
                                            ? "0 0 0 4px rgba(26,107,58,0.15)"
                                            : "none",
                                    transform: isCurrent ? "scale(1.08)" : "scale(1)",
                                }}
                            >
                                {isCompleted ? <Check className="w-4 h-4" strokeWidth={2.5} /> : index + 1}
                            </div>

                            {/* Label below circle */}
                            <div className="text-center" style={{ maxWidth: 72 }}>
                                <p
                                    className="text-xs font-semibold leading-tight transition-colors"
                                    style={{
                                        color: isCurrent
                                            ? "var(--amber-500)"
                                            : isCompleted
                                                ? "var(--green-500)"
                                                : "var(--text-muted)",
                                    }}
                                >
                                    {step.label}
                                </p>
                                {step.description && (
                                    <p className="text-xs leading-tight mt-0.5 hidden sm:block" style={{ color: "var(--text-muted)" }}>
                                        {step.description}
                                    </p>
                                )}
                            </div>
                        </div>

                        {/* Connector line */}
                        {!isLast && (
                            <div
                                className="flex-1 h-[2px] mt-5 mx-1 rounded-full overflow-hidden"
                                style={{ backgroundColor: "var(--border-default)" }}
                            >
                                <div
                                    className="h-full rounded-full transition-all duration-500 ease-in-out"
                                    style={{
                                        width: isCompleted ? "100%" : "0%",
                                        background: "var(--green-500)",
                                    }}
                                />
                            </div>
                        )}
                    </React.Fragment>
                );
            })}
        </div>
    );
};
</file>

<file path="lib/calculator.ts">
import { PayslipInput } from "./schema";

export const NMW_RATE = 30.23; // SD7 as of March 2025
const UIF_MONTHLY_CAP = 17712; // UIF contribution ceiling
const ACCOMMODATION_MAX_PCT = 0.10;
const UIF_RATE = 0.01;
const UIF_THRESHOLD_HOURS = 24; // No UIF if worker ≤ 24 hours
const OVERTIME_MULTIPLIER = 1.5;
const SUNDAY_PH_MULTIPLIER = 2.0;

export interface PayBreakdown {
    ordinaryPay: number;
    overtimePay: number;
    sundayPay: number;
    publicHolidayPay: number;
    grossPay: number;
    totalHours: number;
    deductions: {
        uifEmployee: number;
        accommodation: number | undefined;
        other: number;
        total: number;
    };
    employerContributions: {
        uifEmployer: number;
    };
    netPay: number;
}

export function calculatePayslip(input: PayslipInput): PayBreakdown {
    // Enforce NMW guardrail
    const rate = Math.max(input.hourlyRate, NMW_RATE);

    const ordinaryPay = input.ordinaryHours * rate;
    const overtimePay = input.overtimeHours * rate * OVERTIME_MULTIPLIER;
    const sundayPay = input.sundayHours * rate * SUNDAY_PH_MULTIPLIER;
    const publicHolidayPay = input.publicHolidayHours * rate * SUNDAY_PH_MULTIPLIER;

    const grossPay = ordinaryPay + overtimePay + sundayPay + publicHolidayPay;

    const totalHours =
        input.ordinaryHours + input.overtimeHours + input.sundayHours + input.publicHolidayHours;

    // UIF: only if > 24 hours this period
    const uifBase = Math.min(grossPay, UIF_MONTHLY_CAP);
    const uifEmployee = totalHours > UIF_THRESHOLD_HOURS ? uifBase * UIF_RATE : 0;
    const uifEmployer = totalHours > UIF_THRESHOLD_HOURS ? uifBase * UIF_RATE : 0;

    // Accommodation: max 10% of gross (SD7)
    const accommodation =
        input.includeAccommodation ? Math.min(grossPay * ACCOMMODATION_MAX_PCT, grossPay * ACCOMMODATION_MAX_PCT) : undefined;

    const otherDeductions = input.otherDeductions ?? 0;

    const totalDeductions = uifEmployee + (accommodation ?? 0) + otherDeductions;

    const netPay = grossPay - totalDeductions;

    return {
        ordinaryPay,
        overtimePay,
        sundayPay,
        publicHolidayPay,
        grossPay,
        totalHours,
        deductions: {
            uifEmployee,
            accommodation,
            other: otherDeductions,
            total: totalDeductions,
        },
        employerContributions: {
            uifEmployer,
        },
        netPay,
    };
}
</file>

<file path="lib/contract-pdf.ts">
/**
 * BCEA-Compliant Employment Contract PDF Generator
 * Generates a professional, multi-page employment contract for domestic workers.
 */

import { PDFDocument, rgb, StandardFonts } from "pdf-lib";
import { Employee, EmployerSettings } from "./schema";
import { format } from "date-fns";

const AMBER = rgb(0.77, 0.48, 0.11);
const DARK = rgb(0.11, 0.09, 0.08);
const SLATE = rgb(0.45, 0.40, 0.35);
const WHITE = rgb(1, 1, 1);
const LINE = rgb(0.88, 0.86, 0.83);

export interface ContractInput {
    employee: Employee;
    employer: EmployerSettings;
    startDate: string;       // ISO date
    workDays: string;        // e.g. "Monday to Friday"
    workHoursPerDay: number;
    duties: string;          // Description of duties
    probationMonths: number;
}

export async function generateContractPdfBytes(input: ContractInput): Promise<Uint8Array> {
    const pdfDoc = await PDFDocument.create();
    const regular = await pdfDoc.embedFont(StandardFonts.Helvetica);
    const bold = await pdfDoc.embedFont(StandardFonts.HelveticaBold);

    const MARGIN = 56;
    const PAGE_W = 595.28;
    const PAGE_H = 841.89;
    const CONTENT_W = PAGE_W - MARGIN * 2;
    const LINE_H = 16;

    let page = pdfDoc.addPage([PAGE_W, PAGE_H]);
    let cy = PAGE_H - MARGIN;

    function checkPage(needed: number) {
        if (cy - needed < MARGIN + 40) {
            // Footer on current page
            page.drawText("LekkerLedger — Employment Contract", {
                x: MARGIN, y: 30, size: 7, font: regular, color: SLATE,
            });
            page = pdfDoc.addPage([PAGE_W, PAGE_H]);
            cy = PAGE_H - MARGIN;
        }
    }

    function heading(text: string) {
        checkPage(40);
        cy -= 10;
        page.drawText(text.toUpperCase(), { x: MARGIN, y: cy, size: 9, font: bold, color: AMBER });
        cy -= 4;
        page.drawLine({ start: { x: MARGIN, y: cy }, end: { x: PAGE_W - MARGIN, y: cy }, thickness: 0.5, color: LINE });
        cy -= LINE_H;
    }

    function para(text: string, indented = false) {
        const maxChars = indented ? 78 : 85;
        const x = indented ? MARGIN + 16 : MARGIN;
        const words = text.split(" ");
        let line = "";
        for (const word of words) {
            if ((line + " " + word).length > maxChars && line.length > 0) {
                checkPage(LINE_H);
                page.drawText(line, { x, y: cy, size: 9.5, font: regular, color: DARK });
                cy -= LINE_H;
                line = word;
            } else {
                line = line ? line + " " + word : word;
            }
        }
        if (line) {
            checkPage(LINE_H);
            page.drawText(line, { x, y: cy, size: 9.5, font: regular, color: DARK });
            cy -= LINE_H;
        }
        cy -= 4;
    }

    function field(label: string, value: string) {
        checkPage(LINE_H);
        page.drawText(label + ":", { x: MARGIN, y: cy, size: 9, font: bold, color: SLATE });
        page.drawText(value, { x: MARGIN + 160, y: cy, size: 9.5, font: regular, color: DARK });
        cy -= LINE_H + 2;
    }

    // ── Title header ────────────────────────────────────────────────────────
    page.drawRectangle({ x: 0, y: PAGE_H - 80, width: PAGE_W, height: 80, color: DARK });
    page.drawRectangle({ x: 0, y: PAGE_H - 84, width: PAGE_W, height: 4, color: AMBER });

    page.drawText("EMPLOYMENT CONTRACT", {
        x: MARGIN, y: PAGE_H - 38, size: 22, font: bold, color: WHITE,
    });
    page.drawText("Basic Conditions of Employment Act (BCEA) · Sectoral Determination 7", {
        x: MARGIN, y: PAGE_H - 60, size: 9, font: regular, color: rgb(0.6, 0.55, 0.5),
    });
    page.drawText("LekkerLedger", {
        x: PAGE_W - MARGIN - bold.widthOfTextAtSize("LekkerLedger", 11),
        y: PAGE_H - 42, size: 11, font: bold, color: AMBER,
    });

    cy = PAGE_H - 110;

    // ── Parties ──────────────────────────────────────────────────────────────
    heading("1. Parties to This Agreement");
    field("Employer", input.employer.employerName || "(Not set)");
    field("Employer Address", input.employer.employerAddress || "(Not set)");
    field("Employer ID", input.employer.employerIdNumber || "(Not set)");
    cy -= 6;
    field("Employee", input.employee.name);
    field("Employee ID/Passport", input.employee.idNumber || "(Not provided)");
    field("Employee Phone", input.employee.phone || "(Not provided)");

    // ── Commencement ─────────────────────────────────────────────────────────
    heading("2. Commencement and Duration");
    para(`This contract commences on ${input.startDate ? format(new Date(input.startDate), "d MMMM yyyy") : "(Date)"} and continues indefinitely until terminated by either party in accordance with the Basic Conditions of Employment Act No. 75 of 1997.`);
    if (input.probationMonths > 0) {
        para(`The employee shall serve a probationary period of ${input.probationMonths} month(s) from the commencement date.`);
    }

    // ── Job description ──────────────────────────────────────────────────────
    heading("3. Job Description");
    field("Job Title", input.employee.role);
    para(`The Employee's duties shall include, but are not limited to:`);
    para(input.duties || "General domestic duties as reasonably assigned.", true);

    // ── Working hours ────────────────────────────────────────────────────────
    heading("4. Working Hours");
    field("Working Days", input.workDays || "Monday to Friday");
    field("Hours Per Day", `${input.workHoursPerDay || 8} hours`);
    para("Overtime may be worked by agreement but may not exceed 10 hours per week. Overtime is paid at 1.5× the normal hourly rate. Work on Sundays and public holidays is paid at 2× the normal hourly rate.");

    // ── Remuneration ─────────────────────────────────────────────────────────
    heading("5. Remuneration");
    field("Hourly Rate", `R ${input.employee.hourlyRate.toFixed(2)}`);
    para("The hourly rate shall not be less than the National Minimum Wage for domestic workers as prescribed under Sectoral Determination 7. Wages shall be paid monthly on or before the last working day of each month.");

    // ── Deductions ───────────────────────────────────────────────────────────
    heading("6. Deductions");
    para("The Employer shall deduct 1% of gross remuneration as the Employee's contribution to the Unemployment Insurance Fund (UIF), and shall contribute a further 1% as the Employer's contribution. These contributions shall be paid to the UIF monthly.");
    para("No deductions shall be made without the written consent of the Employee, except where required by law.");

    // ── Leave ────────────────────────────────────────────────────────────────
    heading("7. Leave Entitlements");
    para("Annual Leave: The Employee is entitled to 15 working days' paid leave per year (accrued at 1 day for every 17 days worked). Leave must be taken within 6 months of accrual.");
    para("Sick Leave: The Employee is entitled to 30 days' paid sick leave in a 36-month cycle (10 days per year). A medical certificate is required for absences exceeding 2 consecutive days.");
    para("Family Responsibility Leave: The Employee is entitled to 3 days' paid leave per year after 4 months of continuous employment, for the birth/illness/death of a close family member.");

    // ── Accommodation ────────────────────────────────────────────────────────
    heading("8. Accommodation");
    para("If accommodation is provided, the deduction shall not exceed 10% of the Employee's gross wage, as per Sectoral Determination 7.");

    // ── Termination ──────────────────────────────────────────────────────────
    heading("9. Termination of Employment");
    para("Either party may terminate this contract by giving written notice as follows:");
    para("• During probation: 1 week's notice.", true);
    para("• After 6 months but less than 1 year: 1 week's notice.", true);
    para("• After 1 year: 4 weeks' notice.", true);
    para("Summary dismissal may only occur in cases of serious misconduct as defined by the Labour Relations Act No. 66 of 1995.");

    // ── Dispute resolution ───────────────────────────────────────────────────
    heading("10. Dispute Resolution");
    para("Any disputes arising from this contract shall be referred to the Commission for Conciliation, Mediation and Arbitration (CCMA) in terms of the Labour Relations Act.");

    // ── Signatures ───────────────────────────────────────────────────────────
    heading("11. Signatures");
    cy -= 8;
    const sigY = cy;
    // Left: Employer
    page.drawText("Employer:", { x: MARGIN, y: sigY, size: 9, font: bold, color: SLATE });
    page.drawLine({ start: { x: MARGIN, y: sigY - 28 }, end: { x: MARGIN + 180, y: sigY - 28 }, thickness: 0.5, color: DARK });
    page.drawText("Signature", { x: MARGIN, y: sigY - 40, size: 7.5, font: regular, color: SLATE });
    page.drawLine({ start: { x: MARGIN, y: sigY - 64 }, end: { x: MARGIN + 180, y: sigY - 64 }, thickness: 0.5, color: DARK });
    page.drawText("Date", { x: MARGIN, y: sigY - 76, size: 7.5, font: regular, color: SLATE });

    // Right: Employee
    const rx = PAGE_W / 2 + 20;
    page.drawText("Employee:", { x: rx, y: sigY, size: 9, font: bold, color: SLATE });
    page.drawLine({ start: { x: rx, y: sigY - 28 }, end: { x: rx + 180, y: sigY - 28 }, thickness: 0.5, color: DARK });
    page.drawText("Signature", { x: rx, y: sigY - 40, size: 7.5, font: regular, color: SLATE });
    page.drawLine({ start: { x: rx, y: sigY - 64 }, end: { x: rx + 180, y: sigY - 64 }, thickness: 0.5, color: DARK });
    page.drawText("Date", { x: rx, y: sigY - 76, size: 7.5, font: regular, color: SLATE });

    // Footer on last page
    page.drawLine({ start: { x: MARGIN, y: 50 }, end: { x: PAGE_W - MARGIN, y: 50 }, thickness: 0.5, color: LINE });
    page.drawText(
        "Generated by LekkerLedger — in compliance with BCEA and Sectoral Determination 7 (Domestic Workers).",
        { x: MARGIN, y: 38, size: 7.5, font: regular, color: SLATE }
    );
    page.drawText("lekkerledger.app · By Nightshift Labs ZA · Data processed locally.", {
        x: MARGIN, y: 26, size: 7, font: regular, color: rgb(0.65, 0.6, 0.55),
    });

    return pdfDoc.save();
}
</file>

<file path="lib/leave.ts">
/**
 * BCEA Leave Calculations for Domestic Workers (Sectoral Determination 7)
 *
 * Annual leave:  1 day for every 17 days worked, OR 15 working days per year
 * Sick leave:    30 days over a 36-month cycle (i.e. 10 days/year)
 * Family resp.:  3 days per year (for workers who've been employed > 4 months)
 */

import { LeaveRecord } from "./schema";

// ─── Constants ──────────────────────────────────────────────────────────

export const ANNUAL_LEAVE_DAYS_PER_YEAR = 15;
export const SICK_LEAVE_DAYS_PER_CYCLE = 30; // 36-month cycle
export const SICK_LEAVE_CYCLE_YEARS = 3;
export const FAMILY_LEAVE_DAYS_PER_YEAR = 3;

// ─── Helpers ────────────────────────────────────────────────────────────

function daysBetween(from: Date, to: Date): number {
    const diffMs = to.getTime() - from.getTime();
    return Math.max(0, Math.floor(diffMs / (1000 * 60 * 60 * 24)));
}

function monthsBetween(from: Date, to: Date): number {
    return (to.getFullYear() - from.getFullYear()) * 12 + (to.getMonth() - from.getMonth());
}

// ─── Leave Balances ─────────────────────────────────────────────────────

export interface LeaveBalances {
    annual: { accrued: number; taken: number; remaining: number };
    sick: { accrued: number; taken: number; remaining: number };
    family: { accrued: number; taken: number; remaining: number };
}

/**
 * Calculate leave balances based on employment start date and leave records.
 * @param startDate - ISO date string when the worker started
 * @param leaveRecords - Array of leave records for this employee
 * @param asOfDate - Date to calculate balances as of (defaults to now)
 */
export function calculateLeaveBalances(
    startDate: string,
    leaveRecords: LeaveRecord[],
    asOfDate: Date = new Date()
): LeaveBalances {
    const start = new Date(startDate);
    if (isNaN(start.getTime()) || start > asOfDate) {
        // If invalid or future start date, return zeros
        return {
            annual: { accrued: 0, taken: 0, remaining: 0 },
            sick: { accrued: 0, taken: 0, remaining: 0 },
            family: { accrued: 0, taken: 0, remaining: 0 },
        };
    }

    const months = monthsBetween(start, asOfDate);
    const years = months / 12;

    // Annual leave: 15 days per year, accrued monthly (1.25/month)
    const annualAccrued = Math.floor(years * ANNUAL_LEAVE_DAYS_PER_YEAR * 10) / 10;

    // Sick leave: 30 days per 36-month cycle
    const sickCycles = Math.min(years / SICK_LEAVE_CYCLE_YEARS, 1); // cap at 1 full cycle
    const sickAccrued = Math.floor(sickCycles * SICK_LEAVE_DAYS_PER_CYCLE * 10) / 10;

    // Family responsibility: 3 days per year (only after 4 months employment)
    const daysEmployed = daysBetween(start, asOfDate);
    const familyAccrued = daysEmployed > 120 ? Math.floor(years * FAMILY_LEAVE_DAYS_PER_YEAR * 10) / 10 : 0;

    // Sum taken days by type
    const taken = { annual: 0, sick: 0, family: 0 };
    for (const r of leaveRecords) {
        if (r.type === "annual") taken.annual += r.days;
        else if (r.type === "sick") taken.sick += r.days;
        else if (r.type === "family") taken.family += r.days;
    }

    return {
        annual: {
            accrued: annualAccrued,
            taken: taken.annual,
            remaining: Math.max(0, annualAccrued - taken.annual),
        },
        sick: {
            accrued: sickAccrued,
            taken: taken.sick,
            remaining: Math.max(0, sickAccrued - taken.sick),
        },
        family: {
            accrued: familyAccrued,
            taken: taken.family,
            remaining: Math.max(0, familyAccrued - taken.family),
        },
    };
}
</file>

<file path="lib/pdf.ts">
import { PDFDocument, rgb, StandardFonts } from "pdf-lib";
import { Employee, PayslipInput } from "./schema";
import { calculatePayslip } from "./calculator";
import { format } from "date-fns";

// SA amber gold in PDF colour
const AMBER = rgb(0.77, 0.48, 0.11);
const DARK = rgb(0.11, 0.09, 0.08);
const SLATE = rgb(0.45, 0.40, 0.35);
const WHITE = rgb(1, 1, 1);
const RED = rgb(0.75, 0.22, 0.17);
const GREEN = rgb(0.10, 0.42, 0.23);
const LIGHT_BG = rgb(0.98, 0.97, 0.97);
const LINE = rgb(0.88, 0.86, 0.83);

export async function generatePayslipPdfBytes(
    employee: Employee,
    payslip: PayslipInput
): Promise<Uint8Array> {
    const breakdown = calculatePayslip(payslip);

    const pdfDoc = await PDFDocument.create();
    const page = pdfDoc.addPage([595.28, 841.89]); // A4 portrait
    const { width, height } = page.getSize();

    const regular = await pdfDoc.embedFont(StandardFonts.Helvetica);
    const bold = await pdfDoc.embedFont(StandardFonts.HelveticaBold);

    const t = (
        text: string,
        x: number,
        y: number,
        opts?: {
            font?: typeof regular;
            size?: number;
            color?: typeof DARK;
            align?: "left" | "right";
            maxWidth?: number;
        }
    ) => {
        const font = opts?.font ?? regular;
        const size = opts?.size ?? 10;
        const color = opts?.color ?? DARK;
        let tx = x;
        if (opts?.align === "right") {
            const w = font.widthOfTextAtSize(text, size);
            tx = x - w;
        }
        page.drawText(text, { x: tx, y, size, font, color });
    };

    const line = (y: number, x1 = 48, x2 = width - 48, thickness = 0.5) => {
        page.drawLine({ start: { x: x1, y }, end: { x: x2, y }, thickness, color: LINE });
    };

    const rect = (x: number, y: number, w: number, h: number, color: typeof DARK) => {
        page.drawRectangle({ x, y, width: w, height: h, color });
    };

    // ── Header band ──────────────────────────────────────────────────────────
    rect(0, height - 90, width, 90, DARK);

    t("PAYSLIP", 48, height - 42, { font: bold, size: 26, color: WHITE });
    t("LekkerLedger", 48, height - 65, { font: regular, size: 11, color: rgb(0.6, 0.55, 0.5) });

    // Right side of header
    t("CONFIDENTIAL DOCUMENT", width - 48, height - 42, {
        font: bold, size: 9, color: rgb(0.5, 0.45, 0.40), align: "right",
    });
    t("Nightshift Labs ZA", width - 48, height - 62, {
        font: regular, size: 9, color: rgb(0.4, 0.37, 0.34), align: "right",
    });

    // ── Amber accent bar ─────────────────────────────────────────────────────
    rect(0, height - 94, width, 4, AMBER);

    // ── Employee + Period block ───────────────────────────────────────────────
    const blockY = height - 130;

    // Left: Employee info
    t("EMPLOYEE", 48, blockY + 2, { font: bold, size: 7.5, color: SLATE });
    t(employee.name, 48, blockY - 16, { font: bold, size: 14 });
    t(employee.role, 48, blockY - 32, { font: regular, size: 10, color: SLATE });
    if (employee.idNumber) {
        t(`ID / Passport: ${employee.idNumber}`, 48, blockY - 48, { font: regular, size: 9, color: SLATE });
    }

    // Right: Pay period
    const periodStr = `${format(payslip.payPeriodStart, "d MMM yyyy")} – ${format(payslip.payPeriodEnd, "d MMM yyyy")}`;
    t("PAY PERIOD", width - 48, blockY + 2, { font: bold, size: 7.5, color: SLATE, align: "right" });
    t(periodStr, width - 48, blockY - 16, { font: regular, size: 10, align: "right" });
    t(`Generated: ${format(new Date(), "d MMM yyyy")}`, width - 48, blockY - 32, {
        font: regular, size: 9, color: SLATE, align: "right",
    });

    line(height - 188);

    // ── Earnings section ──────────────────────────────────────────────────────
    let cy = height - 215;

    t("EARNINGS", 48, cy, { font: bold, size: 8, color: AMBER });
    cy -= 22;

    const earningRows: [string, number][] = [
        [`Ordinary hours  (${payslip.ordinaryHours} h × R${payslip.hourlyRate.toFixed(2)}/hr)`, breakdown.ordinaryPay],
    ];
    if (payslip.overtimeHours > 0) {
        earningRows.push([`Overtime hours  (${payslip.overtimeHours} h × R${(payslip.hourlyRate * 1.5).toFixed(2)}/hr — 1.5×)`, breakdown.overtimePay]);
    }
    if (payslip.sundayHours > 0) {
        earningRows.push([`Sunday hours  (${payslip.sundayHours} h × R${(payslip.hourlyRate * 2).toFixed(2)}/hr — 2×)`, breakdown.sundayPay]);
    }
    if (payslip.publicHolidayHours > 0) {
        earningRows.push([`Public holiday hours  (${payslip.publicHolidayHours} h × R${(payslip.hourlyRate * 2).toFixed(2)}/hr — 2×)`, breakdown.publicHolidayPay]);
    }

    for (const [label, amount] of earningRows) {
        t(label, 48, cy, { font: regular, size: 10, color: SLATE });
        t(`R ${amount.toFixed(2)}`, width - 48, cy, { font: regular, size: 10, align: "right" });
        cy -= 20;
    }

    cy -= 6;
    line(cy + 2);
    cy -= 16;
    t("Gross Pay", 48, cy, { font: bold, size: 11 });
    t(`R ${breakdown.grossPay.toFixed(2)}`, width - 48, cy, { font: bold, size: 11, align: "right" });

    // ── Deductions section ────────────────────────────────────────────────────
    cy -= 32;
    t("DEDUCTIONS", 48, cy, { font: bold, size: 8, color: AMBER });
    cy -= 22;

    const uifLabel = breakdown.totalHours > 24
        ? `UIF — employee contribution (1% of capped base)`
        : `UIF — not applicable (worker ≤ 24 hours this period)`;
    t(uifLabel, 48, cy, { font: regular, size: 10, color: SLATE });
    t(`-R ${breakdown.deductions.uifEmployee.toFixed(2)}`, width - 48, cy, { font: regular, size: 10, color: RED, align: "right" });
    cy -= 20;

    if (payslip.includeAccommodation && breakdown.deductions.accommodation) {
        t(`Accommodation deduction (max 10% of gross — SD7)`, 48, cy, { font: regular, size: 10, color: SLATE });
        t(`-R ${breakdown.deductions.accommodation.toFixed(2)}`, width - 48, cy, { font: regular, size: 10, color: RED, align: "right" });
        cy -= 20;
    }

    cy -= 6;
    line(cy + 2);
    cy -= 16;
    t("Total Deductions", 48, cy, { font: bold, size: 11 });
    t(`R ${breakdown.deductions.total.toFixed(2)}`, width - 48, cy, { font: bold, size: 11, align: "right" });

    // ── Net Pay banner ────────────────────────────────────────────────────────
    cy -= 42;
    rect(48, cy - 24, width - 96, 58, AMBER);
    t("NET PAY", 68, cy + 22, { font: bold, size: 12, color: WHITE });
    t(`R ${breakdown.netPay.toFixed(2)}`, width - 68, cy + 18, { font: bold, size: 24, color: WHITE, align: "right" });

    // ── Employer contribution note ────────────────────────────────────────────
    cy -= 48;
    rect(48, cy - 16, width - 96, 44, LIGHT_BG);
    t("Employer Contributions (for your records — not deducted from worker):", 58, cy + 14, { font: bold, size: 8.5, color: SLATE });
    t(`UIF employer contribution (1%): R ${breakdown.employerContributions.uifEmployer.toFixed(2)}`, 58, cy, { font: regular, size: 9, color: SLATE });

    // ── Footer ────────────────────────────────────────────────────────────────
    const footerY = 44;
    line(footerY + 18);
    t(
        "Generated by LekkerLedger — in compliance with the Basic Conditions of Employment Act (BCEA) and Sectoral Determination 7 (Domestic Workers).",
        48, footerY + 6,
        { font: regular, size: 7.5, color: SLATE }
    );
    t("lekkerledger.app · By Nightshift Labs ZA · Data processed locally — never stored on external servers.", 48, footerY - 8, {
        font: regular, size: 7, color: rgb(0.65, 0.6, 0.55),
    });

    return pdfDoc.save();
}
</file>

<file path="lib/schema.ts">
import { z } from "zod";

export const NMW_DOMESTIC = 30.23; // SD7 NMW as of March 2025

export const EmployeeSchema = z.object({
    id: z.string().uuid(),
    name: z.string().min(2, "Full name required (at least 2 characters)"),
    idNumber: z.string().optional().default(""),
    role: z.string().min(1, "Role is required").default("Domestic Worker"),
    hourlyRate: z
        .number()
        .min(NMW_DOMESTIC, `Hourly rate must be at least R${NMW_DOMESTIC} (National Minimum Wage)`),
    phone: z.string().optional().default(""),
    startDate: z.string().optional().default(""), // ISO date string — when employment began
});

export type Employee = z.infer<typeof EmployeeSchema>;

export const PayslipInputSchema = z.object({
    id: z.string(),
    employeeId: z.string(),
    payPeriodStart: z.date(),
    payPeriodEnd: z.date(),
    ordinaryHours: z.number().min(0),
    overtimeHours: z.number().min(0).default(0),
    sundayHours: z.number().min(0).default(0),
    publicHolidayHours: z.number().min(0).default(0),
    hourlyRate: z.number().positive(),
    includeAccommodation: z.boolean().default(false),
    otherDeductions: z.number().min(0).default(0),
    createdAt: z.date(),
    // Phase 1: Leave tracking per payslip
    annualLeaveTaken: z.number().min(0).default(0),
    sickLeaveTaken: z.number().min(0).default(0),
    familyLeaveTaken: z.number().min(0).default(0),
});

// Legacy alias kept for backward compat
export const PayslipSchema = PayslipInputSchema;

export type PayslipInput = z.infer<typeof PayslipInputSchema>;

// ─── Leave Record (Phase 1) ─────────────────────────────────────────────────
export const LeaveRecordSchema = z.object({
    id: z.string(),
    employeeId: z.string(),
    type: z.enum(["annual", "sick", "family"]),
    days: z.number().positive(),
    date: z.string(), // ISO date of leave taken
    payslipId: z.string().optional(), // link to payslip that logged it
    note: z.string().optional().default(""),
});

export type LeaveRecord = z.infer<typeof LeaveRecordSchema>;

// ─── Employer Settings (Phase 5) ─────────────────────────────────────────────
export const EmployerSettingsSchema = z.object({
    employerName: z.string().default(""),
    employerAddress: z.string().default(""),
    employerIdNumber: z.string().default(""),
    uifRefNumber: z.string().default(""), // uFiling reference number
    sdlNumber: z.string().default(""),
});

export type EmployerSettings = z.infer<typeof EmployerSettingsSchema>;
</file>

<file path="lib/share.ts">
/**
 * Share utility — WhatsApp sharing for payslip PDFs
 * Uses Web Share API on mobile, wa.me fallback on desktop
 */

export async function shareViaWhatsApp(
    pdfBytes: Uint8Array,
    employeeName: string,
    phone: string,
    periodLabel: string
): Promise<boolean> {
    const fileName = `Payslip_${employeeName.replace(/\s+/g, "_")}_${periodLabel}.pdf`;
    const file = new File([pdfBytes.slice(0)], fileName, { type: "application/pdf" });

    // Try Web Share API first (works on mobile browsers)
    if (navigator.share && navigator.canShare?.({ files: [file] })) {
        try {
            await navigator.share({
                title: `Payslip for ${employeeName}`,
                text: `Hi ${employeeName.split(" ")[0]}, here is your payslip for ${periodLabel}. Generated by LekkerLedger.`,
                files: [file],
            });
            return true;
        } catch (err) {
            // User cancelled or share failed — fall through to wa.me
            if ((err as Error).name === "AbortError") return false;
        }
    }

    // Fallback: open wa.me with pre-filled text
    const cleanPhone = phone.replace(/\D/g, "");
    const intlPhone = cleanPhone.startsWith("0") ? "27" + cleanPhone.slice(1) : cleanPhone;
    const message = encodeURIComponent(
        `Hi ${employeeName.split(" ")[0]}, here is your payslip for ${periodLabel}. Generated by LekkerLedger.`
    );
    window.open(`https://wa.me/${intlPhone}?text=${message}`, "_blank");

    // Also trigger PDF download so user can attach it manually
    downloadPdf(pdfBytes, fileName);
    return true;
}

export function downloadPdf(pdfBytes: Uint8Array, fileName: string): void {
    const blob = new Blob([pdfBytes.slice(0)], { type: "application/pdf" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = fileName;
    a.click();
    URL.revokeObjectURL(url);
}
</file>

<file path="lib/storage.ts">
import localforage from "localforage";
import { Employee, PayslipInput, LeaveRecord, EmployerSettings } from "./schema";

const employeeStore = localforage.createInstance({ name: "LekkerLedger", storeName: "employees" });
const payslipStore = localforage.createInstance({ name: "LekkerLedger", storeName: "payslips" });
const leaveStore = localforage.createInstance({ name: "LekkerLedger", storeName: "leave" });
const settingsStore = localforage.createInstance({ name: "LekkerLedger", storeName: "settings" });

// ─── Employee CRUD ──────────────────────────────────────────────────────────

export async function getEmployees(): Promise<Employee[]> {
    const employees: Employee[] = [];
    await employeeStore.iterate<Employee, void>((val) => {
        employees.push(val);
    });
    return employees.sort((a, b) => a.name.localeCompare(b.name));
}

export async function getEmployee(id: string): Promise<Employee | null> {
    return employeeStore.getItem<Employee>(id);
}

export async function saveEmployee(employee: Employee): Promise<void> {
    await employeeStore.setItem(employee.id, employee);
}

export async function deleteEmployee(id: string): Promise<void> {
    await employeeStore.removeItem(id);
    // Also delete associated payslips
    const toDelete: string[] = [];
    await payslipStore.iterate<PayslipInput, void>((val, key) => {
        if (val.employeeId === id) toDelete.push(key);
    });
    await Promise.all(toDelete.map((k) => payslipStore.removeItem(k)));
    // Also delete associated leave records
    const leaveToDelete: string[] = [];
    await leaveStore.iterate<LeaveRecord, void>((val, key) => {
        if (val.employeeId === id) leaveToDelete.push(key);
    });
    await Promise.all(leaveToDelete.map((k) => leaveStore.removeItem(k)));
}

// ─── Payslip CRUD ───────────────────────────────────────────────────────────

export async function savePayslip(payslip: PayslipInput): Promise<void> {
    await payslipStore.setItem(payslip.id, payslip);
}

export async function getPayslipsForEmployee(employeeId: string): Promise<PayslipInput[]> {
    const payslips: PayslipInput[] = [];
    await payslipStore.iterate<PayslipInput, void>((val) => {
        if (val.employeeId === employeeId) payslips.push(val);
    });
    return payslips.sort(
        (a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()
    );
}

export async function getLatestPayslip(employeeId: string): Promise<PayslipInput | null> {
    const payslips = await getPayslipsForEmployee(employeeId);
    return payslips.length > 0 ? payslips[0] : null;
}

export async function getAllPayslips(): Promise<PayslipInput[]> {
    const payslips: PayslipInput[] = [];
    await payslipStore.iterate<PayslipInput, void>((val) => {
        payslips.push(val);
    });
    return payslips.sort(
        (a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()
    );
}

// ─── Leave CRUD ─────────────────────────────────────────────────────────────

export async function saveLeaveRecord(record: LeaveRecord): Promise<void> {
    await leaveStore.setItem(record.id, record);
}

export async function getLeaveForEmployee(employeeId: string): Promise<LeaveRecord[]> {
    const records: LeaveRecord[] = [];
    await leaveStore.iterate<LeaveRecord, void>((val) => {
        if (val.employeeId === employeeId) records.push(val);
    });
    return records.sort(
        (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()
    );
}

// ─── Settings ─────────────────────────────────────────────────────────────

const SETTINGS_KEY = "employer-settings";

export async function getSettings(): Promise<EmployerSettings> {
    const s = await settingsStore.getItem<EmployerSettings>(SETTINGS_KEY);
    return s ?? { employerName: "", employerAddress: "", employerIdNumber: "", uifRefNumber: "", sdlNumber: "" };
}

export async function saveSettings(settings: EmployerSettings): Promise<void> {
    await settingsStore.setItem(SETTINGS_KEY, settings);
}
</file>

<file path="lib/ufiling.ts">
/**
 * uFiling CSV Export
 *
 * Generates a CSV for the Department of Labour's uFiling system.
 * Format follows the standard UIF declaration columns.
 */

import { Employee, PayslipInput, EmployerSettings } from "./schema";
import { calculatePayslip } from "./calculator";
import { format } from "date-fns";

export interface UFilingRow {
    employeeName: string;
    idNumber: string;
    periodStart: string;
    periodEnd: string;
    grossRemuneration: number;
    uifEmployee: number;
    uifEmployer: number;
    totalUif: number;
}

export function generateUFilingData(
    employees: Employee[],
    payslips: PayslipInput[],
    month: number, // 0-indexed
    year: number
): UFilingRow[] {
    const rows: UFilingRow[] = [];

    for (const emp of employees) {
        // Find payslips for this employee in the given month/year
        const empPayslips = payslips.filter((p) => {
            const start = new Date(p.payPeriodStart);
            return (
                p.employeeId === emp.id &&
                start.getMonth() === month &&
                start.getFullYear() === year
            );
        });

        for (const ps of empPayslips) {
            const breakdown = calculatePayslip(ps);
            rows.push({
                employeeName: emp.name,
                idNumber: emp.idNumber || "",
                periodStart: format(new Date(ps.payPeriodStart), "yyyy-MM-dd"),
                periodEnd: format(new Date(ps.payPeriodEnd), "yyyy-MM-dd"),
                grossRemuneration: breakdown.grossPay,
                uifEmployee: breakdown.deductions.uifEmployee,
                uifEmployer: breakdown.employerContributions.uifEmployer,
                totalUif: breakdown.deductions.uifEmployee + breakdown.employerContributions.uifEmployer,
            });
        }
    }

    return rows;
}

export function rowsToCsv(rows: UFilingRow[], settings: EmployerSettings): string {
    const header = [
        "Employer Name",
        "UIF Ref Number",
        "Employee Name",
        "ID / Passport Number",
        "Period Start",
        "Period End",
        "Gross Remuneration",
        "Employee UIF (1%)",
        "Employer UIF (1%)",
        "Total UIF",
    ].join(",");

    const dataRows = rows.map((r) =>
        [
            `"${settings.employerName}"`,
            `"${settings.uifRefNumber}"`,
            `"${r.employeeName}"`,
            `"${r.idNumber}"`,
            r.periodStart,
            r.periodEnd,
            r.grossRemuneration.toFixed(2),
            r.uifEmployee.toFixed(2),
            r.uifEmployer.toFixed(2),
            r.totalUif.toFixed(2),
        ].join(",")
    );

    return [header, ...dataRows].join("\n");
}

export function downloadCsv(csv: string, filename: string): void {
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
}
</file>

<file path="__tests__/home.test.tsx">
import { render } from "@testing-library/react";
import { describe, it, expect } from "vitest";
import Page from "@/app/page";

describe("Home page", () => {
    it("renders without crashing", () => {
        render(<Page />);
        expect(document.body).toBeTruthy();
    });
});
</file>

<file path="app/globals.css">
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}
</file>

<file path="app/layout.tsx">
import type { Metadata, Viewport } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import { ThemeProvider } from "@/components/theme-provider";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "LekkerLedger | SA Domestic Worker Payslips",
  description:
    "Create a compliant payslip in under 90 seconds. Fast, reliable, and proudly South African.",
  manifest: "/manifest.json",
};

export const viewport: Viewport = {
  themeColor: "#c47a1c",
  width: "device-width",
  initialScale: 1,
  maximumScale: 1,
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en" suppressHydrationWarning>
      <head>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossOrigin="anonymous" />
        <link
          href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,400;0,14..32,500;0,14..32,600;0,14..32,700;0,14..32,800;0,14..32,900&display=swap"
          rel="stylesheet"
        />
        {/* Inline script to apply theme before first paint — avoids flash */}
        <script
          dangerouslySetInnerHTML={{
            __html: `
              (function(){
                try{
                  var t=localStorage.getItem('ll-theme')||'system';
                  var d=t==='system'
                    ?(window.matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light')
                    :t;
                  document.documentElement.setAttribute('data-theme',d);
                }catch(e){}
              })();
            `,
          }}
        />
      </head>
      <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
        <ThemeProvider>{children}</ThemeProvider>
      </body>
    </html>
  );
}
</file>

<file path="app/page.tsx">
"use client";

import * as React from "react";
import Link from "next/link";
import { ArrowRight, Calculator, Shield, Clock, ChevronRight } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { SideDrawer } from "@/components/layout/side-drawer";
import { NMW_RATE } from "@/lib/calculator";

export default function Home() {
  const [hours, setHours] = React.useState("160");
  const [rate, setRate] = React.useState("30.23");
  const [showCalc, setShowCalc] = React.useState(false);

  const rateNum = parseFloat(rate) || 0;
  const hoursNum = parseFloat(hours) || 0;
  const belowNMW = rateNum > 0 && rateNum < NMW_RATE;

  const preview = React.useMemo(() => {
    if (!rateNum || !hoursNum) return null;
    const effectiveRate = Math.max(rateNum, NMW_RATE);
    const gross = hoursNum * effectiveRate;
    const uifActive = hoursNum > 24;
    const uifBase = Math.min(gross, 17712);
    const uif = uifActive ? uifBase * 0.01 : 0;
    const net = gross - uif;
    return { gross, uif, net, uifActive, effectiveRate };
  }, [rateNum, hoursNum]);

  return (
    <div className="min-h-screen flex flex-col" style={{ backgroundColor: "var(--bg-base)" }}>
      {/* Header */}
      <header
        className="sticky top-0 z-30 px-4 py-3 flex items-center justify-between"
        style={{
          backgroundColor: "var(--bg-surface)",
          borderBottom: "1px solid var(--border-subtle)",
          boxShadow: "var(--shadow-sm)",
        }}
      >
        <SideDrawer />
        <p className="text-sm font-bold tracking-tight" style={{ color: "var(--text-primary)" }}>
          LekkerLedger
        </p>
        <Link href="/employees">
          <Button size="sm" variant="default">
            Get Started
          </Button>
        </Link>
      </header>

      {/* Hero */}
      <main className="flex-1 flex flex-col items-center justify-center px-5 py-16 sm:py-24 text-center max-w-2xl mx-auto w-full">
        <div className="space-y-8 w-full animate-slide-up">
          {/* Badge */}
          <div
            className="inline-flex items-center gap-2 text-xs font-semibold px-4 py-1.5 rounded-full"
            style={{
              backgroundColor: "rgba(196,122,28,0.10)",
              color: "var(--amber-500)",
              border: "1px solid rgba(196,122,28,0.20)",
            }}
          >
            <Shield className="h-3.5 w-3.5" />
            BCEA &amp; Sectoral Determination 7 Compliant
          </div>

          {/* Headline */}
          <div className="space-y-4">
            <h1
              className="text-4xl sm:text-5xl font-extrabold tracking-tight leading-[1.1]"
              style={{ color: "var(--text-primary)" }}
            >
              Compliant payslips in{" "}
              <span style={{ color: "var(--amber-500)" }}>90 seconds.</span>
            </h1>
            <p
              className="text-base sm:text-lg leading-relaxed max-w-lg mx-auto"
              style={{ color: "var(--text-secondary)" }}
            >
              Calculates the correct minimum wage, overtime, UIF, and Sunday
              rates for your domestic worker — then generates a professional
              PDF. No spreadsheets. No guessing.
            </p>
          </div>

          {/* CTAs */}
          <div className="flex flex-col sm:flex-row gap-3 justify-center pt-2">
            <Link href="/employees">
              <Button size="lg" className="w-full sm:w-auto gap-2 font-bold">
                Manage Employees <ArrowRight className="h-5 w-5" />
              </Button>
            </Link>
            <Button
              size="lg"
              variant="outline"
              className="w-full sm:w-auto gap-2"
              onClick={() => setShowCalc((v) => !v)}
            >
              <Calculator className="h-5 w-5" />
              {showCalc ? "Hide Calculator" : "Quick Calculator"}
            </Button>
          </div>

          {/* Quick Calculator */}
          {showCalc && (
            <Card className="max-w-lg mx-auto text-left animate-scale-in">
              <CardContent className="p-6 space-y-5">
                <h2
                  className="text-base font-bold flex items-center gap-2"
                  style={{ color: "var(--text-primary)" }}
                >
                  <Calculator className="h-5 w-5" style={{ color: "var(--amber-500)" }} />
                  Minimum Wage &amp; UIF Calculator
                </h2>

                <div className="grid grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <Label htmlFor="calc-hours">Hours Worked</Label>
                    <Input
                      id="calc-hours"
                      type="number"
                      min="0"
                      placeholder="160"
                      value={hours}
                      onChange={(e) => setHours(e.target.value)}
                    />
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="calc-rate">Hourly Rate (R)</Label>
                    <div className="relative">
                      <span
                        className="absolute left-4 top-3 text-sm font-semibold pointer-events-none"
                        style={{ color: "var(--text-muted)" }}
                      >
                        R
                      </span>
                      <Input
                        id="calc-rate"
                        type="number"
                        min="0"
                        step="0.01"
                        placeholder="30.23"
                        className="pl-8"
                        value={rate}
                        onChange={(e) => setRate(e.target.value)}
                        error={belowNMW ? `Below NMW (min R${NMW_RATE}/hr)` : undefined}
                      />
                    </div>
                  </div>
                </div>

                {belowNMW && (
                  <Alert variant="error">
                    <AlertDescription>
                      National Minimum Wage for Domestic Workers is{" "}
                      <strong>R{NMW_RATE}/hr</strong>. Calculation below uses
                      the legal minimum.
                    </AlertDescription>
                  </Alert>
                )}

                {preview && (
                  <div
                    className="rounded-xl overflow-hidden"
                    style={{ border: "1px solid var(--border-subtle)" }}
                  >
                    <div
                      className="flex justify-between items-center px-5 py-3.5 text-sm"
                      style={{ borderBottom: "1px solid var(--border-subtle)" }}
                    >
                      <span style={{ color: "var(--text-secondary)" }}>
                        Gross ({hoursNum}h × R{preview.effectiveRate.toFixed(2)})
                      </span>
                      <span
                        className="font-semibold tabular-nums"
                        style={{ color: "var(--text-primary)" }}
                      >
                        R {preview.gross.toFixed(2)}
                      </span>
                    </div>
                    <div
                      className="flex justify-between items-center px-5 py-3.5 text-sm"
                      style={{ borderBottom: "1px solid var(--border-subtle)" }}
                    >
                      <span style={{ color: "var(--text-secondary)" }}>
                        UIF (1%){" "}
                        {!preview.uifActive && (
                          <span
                            className="text-xs font-medium"
                            style={{ color: "var(--amber-500)" }}
                          >
                            · not applicable ≤24hrs
                          </span>
                        )}
                      </span>
                      <span className="font-semibold tabular-nums" style={{ color: "var(--red-500)" }}>
                        {preview.uifActive ? `-R ${preview.uif.toFixed(2)}` : "R 0.00"}
                      </span>
                    </div>
                    <div
                      className="flex justify-between items-center px-5 py-4"
                      style={{ backgroundColor: "var(--amber-500)" }}
                    >
                      <span className="font-bold text-white">Net Pay (est.)</span>
                      <span className="font-extrabold text-white text-xl tabular-nums">
                        R {preview.net.toFixed(2)}
                      </span>
                    </div>
                  </div>
                )}

                <p
                  className="text-xs text-center"
                  style={{ color: "var(--text-muted)" }}
                >
                  Estimate only. Create a full payslip PDF via the wizard.
                </p>

                <Link href="/employees" className="block">
                  <Button className="w-full gap-2">
                    Create Full Payslip <ChevronRight className="h-4 w-4" />
                  </Button>
                </Link>
              </CardContent>
            </Card>
          )}

          {/* Trust signals */}
          <div
            className="flex flex-wrap justify-center gap-x-6 gap-y-2 pt-4 text-sm"
            style={{ color: "var(--text-muted)" }}
          >
            <span className="flex items-center gap-1.5">
              <Shield className="h-4 w-4" style={{ color: "var(--green-500)" }} />
              Data stays on your device
            </span>
            <span className="flex items-center gap-1.5">
              <Clock className="h-4 w-4" style={{ color: "var(--amber-500)" }} />
              Under 90 seconds
            </span>
            <span className="flex items-center gap-1.5">
              <Calculator className="h-4 w-4" style={{ color: "var(--green-500)" }} />
              Free during beta
            </span>
          </div>
        </div>
      </main>
    </div>
  );
}
</file>

<file path="e2e/home.spec.ts">
import { test, expect } from "@playwright/test";

test("home page loads and has correct title", async ({ page }) => {
    await page.goto("/");
    await expect(page).toHaveTitle(/Next/i);
});

test("home page contains a main element", async ({ page }) => {
    await page.goto("/");
    const main = page.locator("main");
    await expect(main).toBeVisible();
});
</file>

<file path="eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="lib/schemas/payslip.ts">
/**
 * Payslip schemas — define the "shape" of your data here.
 *
 * Zod validates data at runtime so you catch bad inputs early,
 * for example when reading form data or API responses.
 *
 * Usage:
 *   import { PayslipSchema } from "@/lib/schemas/payslip";
 *   const result = PayslipSchema.safeParse(someData);
 *   if (!result.success) console.error(result.error);
 */

import { z } from "zod";

/** Schema for a single payslip entry */
export const PayslipSchema = z.object({
    employeeName: z.string().min(1, "Employee name is required"),
    idNumber: z
        .string()
        .length(13, "SA ID number must be 13 digits")
        .regex(/^\d+$/, "ID number must contain only digits"),
    grossSalary: z.number().positive("Gross salary must be positive"),
    taxPeriod: z.enum([
        "monthly",
        "weekly",
        "fortnightly",
    ]),
});

/** TypeScript type inferred from the schema — keeps types & validation in sync */
export type Payslip = z.infer<typeof PayslipSchema>;
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;
</file>

<file path="playwright.config.ts">
import { defineConfig, devices } from "@playwright/test";

export default defineConfig({
    testDir: "./e2e",
    fullyParallel: true,
    forbidOnly: !!process.env.CI,
    retries: process.env.CI ? 2 : 0,
    workers: process.env.CI ? 1 : undefined,
    reporter: "html",
    use: {
        baseURL: "http://localhost:3000",
        trace: "on-first-retry",
    },
    projects: [
        {
            name: "chromium",
            use: { ...devices["Desktop Chrome"] },
        },
    ],
    webServer: {
        command: "npm run dev",
        url: "http://localhost:3000",
        reuseExistingServer: !process.env.CI,
        timeout: 120_000,
    },
});
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
</file>

<file path="vitest.config.ts">
/// <reference types="vitest/config" />
import { defineConfig } from "vitest/config";
import react from "@vitejs/plugin-react";
import path from "path";

export default defineConfig({
    plugins: [react()],
    test: {
        environment: "jsdom",
        globals: true,
        setupFiles: ["./vitest.setup.ts"],
        include: ["**/*.test.{ts,tsx}"],
    },
    resolve: {
        alias: {
            "@": path.resolve(__dirname, "."),
        },
    },
});
</file>

<file path="vitest.setup.ts">
import "@testing-library/jest-dom/vitest";
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage
/test-results/
/playwright-report/
/blob-report/

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="package.json">
{
  "name": "lekkerledger",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint",
    "test": "vitest run",
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui"
  },
  "dependencies": {
    "next": "16.1.6",
    "react": "19.2.3",
    "react-dom": "19.2.3",
    "zod": "^4.3.6"
  },
  "devDependencies": {
    "@playwright/test": "^1.58.2",
    "@tailwindcss/postcss": "^4",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.2",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "@vitejs/plugin-react": "^5.1.4",
    "eslint": "^9",
    "eslint-config-next": "16.1.6",
    "jsdom": "^28.1.0",
    "tailwindcss": "^4",
    "typescript": "^5",
    "vitest": "^4.0.18"
  }
}
</file>

</files>
